{"version":3,"file":"Ais.js","sources":["../../../../src/AISEvents.js","../../../../src/Chooser.js","../../../../src/AIS.js","../../../../src/main.js"],"sourcesContent":["export default {\n  CHOOSE_PROVIDER: \"chooseprovider\",\n  AUTHENTICATED: \"authenticated\",\n  AUTHENTICATION_FAILED: \"authenticationfailed\",\n  AUTHORIZED: \"authorized\",\n  AUTHORIZATION_FAILED: \"authorizationfailed\"\n}\n","export default class Chooser  {\n\n  constructor(plugin, response) {\n    const create = akamai.amp.Utils.createElement\n    const chooser = create(\"amp-ais-chooser\", chooser)\n    const title = create(\"amp-ais-chooser-title\", chooser, \"Choose your provider\")\n    const grid = create(\"amp-ais-chooser-grid\", chooser)\n    const menu = create(\"amp-ais-chooser-menu\", chooser)\n    const label = create(\"amp-ais-chooser-label\", menu, \"Providers: \")\n    const select = create(\"amp-ais-chooser-select\", menu, null, \"select\")\n    const login = create(\"amp-ais-chooser-login\", menu, \"Login\", \"button\")\n    login.onclick = (event) => {\n      const idpId = select.options[select.selectedIndex].value\n      plugin.login(idpId)\n    }\n\n    // create thumbnail grid\n    const idps = response.possible_idps\n    const groups = response.grouped_idps\n    const logos = plugin.config.logos || {}\n    const base = logos.base || \"\"\n\n    if (groups != null && logos.group != null) {\n      const featuredGroup = groups.filter((group) => group.name === logos.group)[0]\n      if (featuredGroup != null) {\n        featuredGroup.members.forEach((member) => {\n          const idp = idps[member]\n          const div = create(\"amp-ais-chooser-grid-item\", grid)\n          div.onclick = plugin.login.bind(plugin, member)\n\n          if (idps[member].logos && idps[member].logos[logos.key]) {\n            const img = create(\"amp-ais-chooser-grid-cell-img\", div, null, \"img\")\n            const src = idp.logos[logos.key]\n            img.src = (src.indexOf(\"http\") === -1) ? base + src : src\n            img.alt = idp.display_name\n          }\n\n          const span = create(\"amp-ais-chooser-grid-cell-label\", div, idp.display_name, \"span\")\n        })\n      }\n    }\n\n    if (grid.innerHTML) {\n      chooser.classList.add(\"amp-ais-chooser-featured\")\n      label.textContent = \"Other \"\n    }\n\n    // populate select menu\n    const options = select.options\n    const footprints = response.footprints || []\n\n    footprints.forEach((key) => {\n      select.add(new Option(`${idps[key].display_name}`, key))\n    })\n\n    for (let key in idps) {\n      select.add(new Option(`${idps[key].display_name}`, key))\n    }\n\n    // add the chooser to the player's UI\n    plugin.player.container.appendChild(chooser)\n  }\n\n}\n","import AISEvents from \"./AISEvents\"\nimport Chooser from \"./Chooser\"\n\nexport default class AIS extends akamai.amp.Plugin {\n\n  constructor(player, config) {\n    super(player, config)\n\n    this.feature = \"auth\"\n    this.client = window.ais_client\n    this.client.setLogging(this.debug) // Enable AIS logging, log to console.log\n    this.client.setPlatformId(this.config.platformId)  // Set AIS platform_id\n    this.client.setUseCache(this.config.useCache === true)\n\n    // setup media transform\n    if (this.config.transform !== false) {\n      this.player.addTransform(akamai.amp.TransformType.MEDIA, {transform: this.mediaTransform.bind(this), priority: 1})\n    }\n  }\n\n  mediaTransform(media) {\n    const status = media.status\n    if (this.player.security.authorized === true)\n      return media\n\n    this.player.busy = true\n\n    return this.authenticate()\n      .then(() => {\n        this.logger.log(\"[AMP AIS] Authenticated\")\n        return this.authorize()\n      })\n      .then((authorization) => {\n        this.logger.log(\"[AMP AIS] Authorized\")\n        media.authorization = authorization\n        this.player.busy = false\n        return media\n      })\n  }\n\n  request(type, event = type, ...args) {\n    return new Promise((resolve, reject) => {\n      try {\n        this.client.assignhandler(event, (type, resp) => {\n          resolve(resp)\n        })\n        this.client[type].apply(this.client, args)\n      }\n      catch (error) {\n        reject(error)\n      }\n    })\n  }\n\n  bounce() {\n    return this.request(\"bounce\")\n  }\n\n  init() {\n    return this.request(\"init\")\n  }\n\n  chooser() {\n    return this.request(\"chooser\")\n      .then((response) => {\n        this.idps = response.possible_idps = this.sort(response.possible_idps, \"value\", \"display_name\")\n        this.player.busy = false\n        return new Promise((resolve, reject) => {\n          this.chooser = new Chooser(this, response)\n          this.dispatch(AISEvents.CHOOSE_PROVIDER, response)\n        })\n      })\n  }\n\n  identity() {\n    return this.request(\"identity\")\n  }\n\n  resourceAccess(resourceId) {\n    return this.request(\"resourceAccess\", \"authz_query\", resourceId)\n  }\n\n  canPreview() {\n    const preview = this.data.preview\n    return (preview && typeof preview.duration == \"number\")\n  }\n\n  preview() {\n    return Promise.reject()\n  }\n\n  fail() {\n    if (this.canPreview()) {\n      return this.preview()\n    }\n    else {\n      return this.chooser()\n    }\n  }\n\n  authenticate() {\n    return this.bounce()\n      .then((response) => {\n        if (response.authenticated === true) {\n          return this.init()\n            .then((response) => {\n              const key = Object.keys(response.idps)[0]\n              this.idps = Object.assign({key}, response.idps[key])\n              if (this.config.logos && this.idps.logos) {\n                this.idps.logo = this.config.logos.base + this.idps.logos[this.config.logos.key]\n              }\n\n              // logout can be triggered by the server, so add the\n              // listener here instead of waiting for the logout API call\n              this.client.assignhandler('logout_result', () => {\n                // Reload experience to restart workflow, could be returned in AuthZ\n                top.location.href = top.location.href\n              })\n\n              this.dispatch(AISEvents.AUTHENTICATED, this.idps)\n            })\n        }\n        else {\n          this.dispatch(AISEvents.AUTHENTICATION_FAILED, response)\n          return this.fail()\n        }\n      })\n  }\n\n  authorize(resourceId = this.config.resourceId) {\n    return this.resourceAccess(resourceId)\n      .then((response) => {\n        if (response.authorization === true) {\n          this.viewerId = this.client.aisuid\n          const auth = {key: this.config.query || \"hdnts\", token: response.security_token}\n          this.dispatch(AISEvents.AUTHORIZED, auth)\n          return auth\n        }\n        else {\n          this.dispatch(AISEvents.AUTHORIZATION_FAILED, response)\n          return this.fail()\n        }\n      })\n  }\n\n  sort(obj, sortType, valueName) { // Object sorter, used for chooser data\n    const returnObj = {}\n    const data = []\n    let index = 0\n\n    for (let key in obj) {\n      data[index] = {\n        key: key,\n        value: obj[key][valueName] || \"\"\n      }\n      index++\n    }\n\n    data.sort(function (a, b) {\n      const valueA = (sortType === \"value\") ? a.value.toLowerCase() : a.key.toLowercase()\n      const valueB = (sortType === \"value\") ? b.value.toLowerCase() : b.key.toLowercase()\n\n      if (valueA < valueB) { // sort string ascending\n        return -1\n      }\n      else if (valueA > valueB) {\n        return 1\n      }\n      else {\n        return 0 // default return value (no sorting)\n      }\n    });\n\n    // Build new object based on sorted array\n    return data.reduce(function (map, item) {\n      map[item.key] = obj[item.key]\n      return map\n    }, {})\n  }\n\n  getTarget(method = \"redirect\") {\n    return this.config.responseTargets[method]\n  }\n\n  setRedirect(method) {\n    try {\n      const devToken = /\\/dev\\./\n      const loc = window.top.location.href || window.top.location\n      const domain = (devToken.test(loc)) ? loc.replace(devToken, \"/\") : null\n      akamai.amp.Cookies.setCookie(this.getTarget(method), loc, 1, \"/\", domain)\n    }\n    catch (error) {}\n  }\n\n  launchIdp(idp_platform_id) {\n    const idp = (idp_platform_id != null) ? this.idps[idp_platform_id] : this.idps\n    const display = idp.window_display || {}\n    const method = (display.method != null) ? display.method : \"redirect\"\n    const target = this.getTarget(method)\n    const format = (idp_platform_id != null) ? this.client.loginFormat(idp_platform_id, target) : this.client.logoutFormat(target)\n\n    this.setRedirect(method)\n\n    switch (method) {\n      case \"redirect\":\n        window.open(format, \"_top\") // Full page redirect\n        break;\n      case \"popup\":\n        //method = display.method || \"popup\"\n        const width = display.width || 320\n        const height = display.height || 240\n        window.open(format, \"ais_popup\", `width=${width},height=${height}`)\n    }\n  }\n\n  login(idp_platform_id) {\n    this.launchIdp(idp_platform_id)\n  }\n\n  logout() {\n    this.launchIdp()\n  }\n}\n","import \"./main.less\"\nimport AIS from \"./AIS\"\nimport AISEvents from \"./AISEvents\"\n\n\nakamai.amp.AMP.registerPlugin(\"ais\", akamai.amp.Plugin.createFactory(AIS))\n\nexport {default as AISEvents} from \"./AISEvents.js\"\nexport {AIS}\n"],"names":["Chooser","plugin","response","create","akamai","amp","Utils","createElement","chooser","title","grid","menu","label","select","login","onclick","event","idpId","options","selectedIndex","value","idps","possible_idps","groups","grouped_idps","logos","config","base","group","featuredGroup","filter","name","members","forEach","member","idp","div","bind","key","img","src","indexOf","alt","display_name","span","innerHTML","classList","add","textContent","footprints","Option","player","container","appendChild","AIS","feature","client","window","ais_client","setLogging","debug","setPlatformId","platformId","setUseCache","useCache","transform","addTransform","TransformType","MEDIA","mediaTransform","priority","media","status","security","authorized","busy","authenticate","then","logger","log","authorize","authorization","type","args","Promise","resolve","reject","assignhandler","resp","apply","error","request","sort","dispatch","AISEvents","CHOOSE_PROVIDER","resourceId","preview","data","duration","canPreview","bounce","authenticated","init","Object","keys","assign","logo","location","href","top","AUTHENTICATED","AUTHENTICATION_FAILED","fail","resourceAccess","viewerId","aisuid","auth","query","token","security_token","AUTHORIZED","AUTHORIZATION_FAILED","obj","sortType","valueName","returnObj","index","a","b","valueA","toLowerCase","toLowercase","valueB","reduce","map","item","method","responseTargets","devToken","loc","domain","test","replace","Cookies","setCookie","getTarget","idp_platform_id","display","window_display","target","format","loginFormat","logoutFormat","setRedirect","open","width","height","launchIdp","Plugin","AMP","registerPlugin","createFactory"],"mappings":"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"}