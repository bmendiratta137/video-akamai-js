!function(e){"use strict";var t={CHOOSE_PROVIDER:"chooseprovider",AUTHENTICATED:"authenticated",AUTHENTICATION_FAILED:"authenticationfailed",AUTHORIZED:"authorized",AUTHORIZATION_FAILED:"authorizationfailed"},i=function e(t,i){babelHelpers.classCallCheck(this,e);var n=akamai.amp.Utils.createElement,a=n("amp-ais-chooser",a),o=(n("amp-ais-chooser-title",a,"Choose your provider"),n("amp-ais-chooser-grid",a)),r=n("amp-ais-chooser-menu",a),s=n("amp-ais-chooser-label",r,"Providers: "),u=n("amp-ais-chooser-select",r,null,"select"),c=n("amp-ais-chooser-login",r,"Login","button");c.onclick=function(e){var i=u.options[u.selectedIndex].value;t.login(i)};var l=i.possible_idps,h=i.grouped_idps,p=t.config.logos||{},d=p.base||"";if(null!=h&&null!=p.group){var f=h.filter(function(e){return e.name===p.group})[0];null!=f&&f.members.forEach(function(e){var i=l[e],a=n("amp-ais-chooser-grid-item",o);if(a.onclick=t.login.bind(t,e),l[e].logos&&l[e].logos[p.key]){var r=n("amp-ais-chooser-grid-cell-img",a,null,"img"),s=i.logos[p.key];r.src=s.indexOf("http")===-1?d+s:s,r.alt=i.display_name}n("amp-ais-chooser-grid-cell-label",a,i.display_name,"span")})}o.innerHTML&&(a.classList.add("amp-ais-chooser-featured"),s.textContent="Other ");var g=(u.options,i.footprints||[]);g.forEach(function(e){u.add(new Option(""+l[e].display_name,e))});for(var v in l)u.add(new Option(""+l[v].display_name,v));t.player.container.appendChild(a)},n=function(e){function n(e,t){babelHelpers.classCallCheck(this,n);var i=babelHelpers.possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,t));return i.feature="auth",i.client=window.ais_client,i.client.setLogging(i.debug),i.client.setPlatformId(i.config.platformId),i.client.setUseCache(i.config.useCache===!0),i.config.transform!==!1&&i.player.addTransform(akamai.amp.TransformType.MEDIA,{transform:i.mediaTransform.bind(i),priority:1}),i}return babelHelpers.inherits(n,e),babelHelpers.createClass(n,[{key:"mediaTransform",value:function(e){var t=this;e.status;return this.player.security.authorized===!0?e:(this.player.busy=!0,this.authenticate().then(function(){return t.logger.log("[AMP AIS] Authenticated"),t.authorize()}).then(function(i){return t.logger.log("[AMP AIS] Authorized"),e.authorization=i,t.player.busy=!1,e}))}},{key:"request",value:function(e){for(var t=arguments.length,i=Array(t>2?t-2:0),n=2;n<t;n++)i[n-2]=arguments[n];var a=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return new Promise(function(t,n){try{a.client.assignhandler(o,function(e,i){t(i)}),a.client[e].apply(a.client,i)}catch(e){n(e)}})}},{key:"bounce",value:function(){return this.request("bounce")}},{key:"init",value:function(){return this.request("init")}},{key:"chooser",value:function(){var e=this;return this.request("chooser").then(function(n){return e.idps=n.possible_idps=e.sort(n.possible_idps,"value","display_name"),e.player.busy=!1,new Promise(function(a,o){e.chooser=new i(e,n),e.dispatch(t.CHOOSE_PROVIDER,n)})})}},{key:"identity",value:function(){return this.request("identity")}},{key:"resourceAccess",value:function(e){return this.request("resourceAccess","authz_query",e)}},{key:"canPreview",value:function(){var e=this.data.preview;return e&&"number"==typeof e.duration}},{key:"preview",value:function(){return Promise.reject()}},{key:"fail",value:function(){return this.canPreview()?this.preview():this.chooser()}},{key:"authenticate",value:function(){var e=this;return this.bounce().then(function(i){return i.authenticated===!0?e.init().then(function(i){var n=Object.keys(i.idps)[0];e.idps=Object.assign({key:n},i.idps[n]),e.config.logos&&e.idps.logos&&(e.idps.logo=e.config.logos.base+e.idps.logos[e.config.logos.key]),e.client.assignhandler("logout_result",function(){top.location.href=top.location.href}),e.dispatch(t.AUTHENTICATED,e.idps)}):(e.dispatch(t.AUTHENTICATION_FAILED,i),e.fail())})}},{key:"authorize",value:function(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.resourceId;return this.resourceAccess(i).then(function(i){if(i.authorization===!0){e.viewerId=e.client.aisuid;var n={key:e.config.query||"hdnts",token:i.security_token};return e.dispatch(t.AUTHORIZED,n),n}return e.dispatch(t.AUTHORIZATION_FAILED,i),e.fail()})}},{key:"sort",value:function(e,t,i){var n=[],a=0;for(var o in e)n[a]={key:o,value:e[o][i]||""},a++;return n.sort(function(e,i){var n="value"===t?e.value.toLowerCase():e.key.toLowercase(),a="value"===t?i.value.toLowerCase():i.key.toLowercase();return n<a?-1:n>a?1:0}),n.reduce(function(t,i){return t[i.key]=e[i.key],t},{})}},{key:"getTarget",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"redirect";return this.config.responseTargets[e]}},{key:"setRedirect",value:function(e){try{var t=/\/dev\./,i=window.top.location.href||window.top.location,n=t.test(i)?i.replace(t,"/"):null;akamai.amp.Cookies.setCookie(this.getTarget(e),i,1,"/",n)}catch(e){}}},{key:"launchIdp",value:function(e){var t=null!=e?this.idps[e]:this.idps,i=t.window_display||{},n=null!=i.method?i.method:"redirect",a=this.getTarget(n),o=null!=e?this.client.loginFormat(e,a):this.client.logoutFormat(a);switch(this.setRedirect(n),n){case"redirect":window.open(o,"_top");break;case"popup":var r=i.width||320,s=i.height||240;window.open(o,"ais_popup","width="+r+",height="+s)}}},{key:"login",value:function(e){this.launchIdp(e)}},{key:"logout",value:function(){this.launchIdp()}}]),n}(akamai.amp.Plugin);akamai.amp.AMP.registerPlugin("ais",akamai.amp.Plugin.createFactory(n)),e.AIS=n,e.AISEvents=t}(this.akamai.amp.ais=this.akamai.amp.ais||{});
//# sourceMappingURL=Ais.min.js.map