{"version":3,"file":"Aframe.js","sources":["../../../../src/components/Mouse.js","../../../../src/Aframe.js","../../../../src/main.js"],"sourcesContent":["class Mouse {\n  constructor(enabled, speed) {\n    this.NAME = \"mouse-rotation\";\n\n    this.register(enabled, speed)\n  }\n\n  register(enabled, speed) {\n    AFRAME.registerComponent(this.NAME, {\n      schema: {\n        enabled: { default: enabled || false },\n        dx: { default: 2.0 },\n        dy: { default: 2.0 },\n        speed: { default: speed != null ? speed / 10 : 0.3 }\n      },\n      rotateEnd_: null,\n      init: function () {\n        this.onMouseUp_ = this.onMouseUp_.bind(this);\n        this.onMouseDown_ = this.onMouseDown_.bind(this);\n        this.onMouseMove_ = this.onMouseMove_.bind(this);\n        this.directionX = 0;\n        this.directionY = 0;\n\n        this.rotateStart_ = new THREE.Vector2(),\n          this.rotateEnd_ = new THREE.Vector2(),\n          this.rotateDelta_ = new THREE.Vector2(),\n          this.isDragging_ = false\n      },\n      play: function () {\n        window.addEventListener('mousemove', this.onMouseMove_);\n        window.addEventListener('mousedown', this.onMouseDown_);\n        window.addEventListener('mouseup', this.onMouseUp_);\n      },\n      pause: function () {\n        window.addEventListener('mousemove', this.onMouseMove_);\n        window.addEventListener('mousedown', this.onMouseDown_);\n        window.addEventListener('mouseup', this.onMouseUp_);\n      },\n      isPointerLocked_: function () {\n        var el = document.pointerLockElement || document.mozPointerLockElement ||\n          document.webkitPointerLockElement;\n        return el !== undefined;\n      },\n      onMouseUp_: function (e) {\n        this.directionX = 0;\n        this.isDragging_ = false;\n      },\n      onMouseDown_: function (e) {\n        this.rotateStart_.set(e.clientX, e.clientY);\n        this.isDragging_ = true\n      },\n      onMouseMove_: function (e) {\n        if (!this.isDragging_ && !this.isPointerLocked_()) {\n          return;\n        }\n        if (!this.isPointerLocked_()) {\n          var movementX = e.movementX || e.mozMovementX || 0;\n          var movementY = e.movementY || e.mozMovementY || 0;\n          this.rotateEnd_.set(this.rotateStart_.x - movementX, this.rotateStart_.y - movementY);\n        } else {\n          this.rotateEnd_.set(e.clientX, e.clientY);\n        }\n        this.rotateDelta_.subVectors(this.rotateEnd_, this.rotateStart_);\n        this.rotateStart_.copy(this.rotateEnd_);\n\n        this.directionX = movementX * this.data.speed;\n      },\n      tick: function (t, dt) {\n        if (!this.data.enabled) { return; }\n        var rotation = this.el.getAttribute('rotation');\n        if (!rotation) { return; }\n        if ((this.directionX || this.directionY)) {\n          rotation.x += this.data.dx * this.directionY;\n          rotation.y += this.data.dy * this.directionX;\n\n          this.el.setAttribute('rotation', rotation);\n        }\n        if (this.data.speed !== this.schema.speed.default)\n          this.data.speed = this.schema.speed.default\n      }\n    });\n  };\n\n  update(value) {\n    let _ref;\n    if ((_ref = AFRAME.components[this.NAME]) != null && 10 > value ? _ref.schema != null : false) {\n      _ref.schema.speed.default = value / 10;\n    }\n  }\n}\n\nexport { Mouse as default }","import Mouse from \"./components/Mouse.js\"\n\nexport default class Aframe extends akamai.amp.Plugin {\n  constructor(player, config) {\n    super(player, config)\n\n    this.container = player.container\n    this.scene = document.createElement(\"a-scene\")\n    this.sphere = document.createElement(\"a-videosphere\")\n    this.sky = document.createElement(\"a-sky\");// 360 poster image\n    this.scene.setAttribute(\"vr-mode-ui\", `enabled: ${this.isCompatible()}`)\n    this.sphere.setAttribute(\"rotation\", this.config.data.rotation || \"0 180 0\")\n    this.pattern = typeof (config.data.pattern) != 'undefined' ? new RegExp(config.data.pattern, \"i\") : new RegExp(\"360\", \"i\");\n    this.pattern = config.data.strict ? this.pattern : new RegExp(\"\", \"i\");\n\n    if (config.mouse != null && config.mouse.speed) {\n      this.mouse = new Mouse(true, config.mouse.speed);\n    }\n  }\n\n  onready(event) {\n    this.initComponent();\n    this.player.addEventListener(\"mediachange\", this.onMediaChangeHandler.bind(this));\n  }\n\n  onMediaChangeHandler() {\n    let media = this.player.media !== null ? this.player.media : this.player.getMedia();\n    let hasSphereElement = this.scene.getChildEntities().indexOf(this.sphere) > -1;\n    let hasSkyElement = this.scene.getChildEntities().indexOf(this.sky) > -1;\n    let category = typeof (media.category) != 'undefined' ? media.category : \"\";\n\n    switch (media.medium) {\n      case 'audio':\n        this.sky.setAttribute(\"src\", media.poster);\n        this.scene.appendChild(this.sky);\n        this.player.setDisplayState('aframe-sky');\n        if (hasSphereElement)\n          this.scene.removeChild(this.sphere);\n        break;\n      default:\n        if (this.pattern.test(category)) {\n          this.player.setDisplayState('aframe-sphere');\n          if (hasSkyElement)\n            this.scene.removeChild(this.sky)\n          this.scene.appendChild(this.sphere);\n        }\n        else {\n          this.player.setDisplayState('non-sphere');\n          if (hasSphereElement)\n            this.scene.removeChild(this.sphere);\n        }\n        break;\n    }\n  }\n\n  initComponent() {\n    this.player.mediaElement.setAttribute(\"id\", \"videoamp\") // adding id to video player for sphere src reference\n    this.sphere.setAttribute(\"src\", \"#videoamp\")\n    this.sphere.setAttribute(\"mouse-rotation\", '')\n    this.scene.appendChild(this.sphere)\n\n    const layer = document.createElement(\"div\")\n    layer.className = \"amp-vr\"\n    layer.appendChild(this.scene)\n\n    //append a-frame scene to player\n    this.container.appendChild(layer)\n  }\n\n  updateMouseSpeed(value) {\n    if (this.mouse) {\n      this.mouse.update(value);\n    }\n  }\n\n  isCompatible() {\n    const compatible = (typeof navigator.getVRDisplays == \"function\")\n    if (compatible === false) {\n      console.log(\"Your browser is not compatible with A-Frame check this page out https://get.webgl.org/\")\n    }\n    return compatible\n  }\n}\n","import \"./main.less\"\nimport Aframe from \"./Aframe.js\"\n\nakamai.amp.AMP.registerPlugin(\"aframe\", typeof(akamai.amp.Plugin.createFactory) == 'function' ? akamai.amp.Plugin.createFactory(Aframe) : Aframe.factory)\n\nexport {Aframe}\n"],"names":["Mouse","enabled","speed","NAME","register","registerComponent","default","onMouseUp_","bind","onMouseDown_","onMouseMove_","directionX","directionY","rotateStart_","THREE","Vector2","rotateEnd_","rotateDelta_","isDragging_","addEventListener","el","document","pointerLockElement","mozPointerLockElement","webkitPointerLockElement","undefined","e","set","clientX","clientY","isPointerLocked_","movementX","mozMovementX","movementY","mozMovementY","x","y","subVectors","copy","data","t","dt","rotation","getAttribute","dx","dy","setAttribute","schema","value","_ref","AFRAME","components","Aframe","player","config","container","scene","createElement","sphere","sky","isCompatible","pattern","RegExp","strict","mouse","event","initComponent","onMediaChangeHandler","media","getMedia","hasSphereElement","getChildEntities","indexOf","hasSkyElement","category","medium","poster","appendChild","setDisplayState","removeChild","test","mediaElement","layer","className","update","compatible","navigator","getVRDisplays","log","akamai","amp","Plugin","AMP","registerPlugin","createFactory","factory"],"mappings":"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"}