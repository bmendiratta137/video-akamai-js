{"version":3,"sources":["../../../../src/Mux.js"],"names":["Mux","player","event","map","isAdEvent","config","data","muxEvent","element","playerEvent","ads","getEnabled","sdk","mux","assign","mapEvents","addEventListener","emit","detail","log","media","guid","title","duration","temporalType","poster","src","type","adthirdquartile","adended","this","createClass","error","language","video_source_duration","isNaN","mediaElement","undefined","Math","round","init","videoWidth","preload","clientWidth","clientHeight","code","message","console","_this","amp","Promise","akamai","resolve"],"mappings":"+TACqBA,EAAAA,0BAEZC,iBAAL,QAAA,SAAAC,gBAO6BC,EAAAC,eACTH,GACjBI,EAAOC,iBANVH,EAAAI,GAAA,SAAAC,EAAAD,EAAAE,2EAWQC,EAAMT,KAAAA,EAAcM,UAAkC,KAAPC,EAAAD,OAblDF,GAALJ,EAAcI,MAAdM,WAAA,WACKC,OAAMC,GACNP,cAAcQ,gCAaRC,eACER,gBACAS,mBACAZ,sCAGA,6BAGDa,gBACC,+DAIDhB,EAAQiB,eACRC,IAAA,WADQ,wBAEL,wBACFC,EAHOC,iBAIFD,EAAAE,qBACHF,EALKG,uBAAA,QAMNH,EANMI,8BAAAJ,EAAAK,wBAAAL,EAAAM,2BASLN,EAAAO,WAIPP,iBACID,aACCX,qBACGY,wBACGA,+EAIKA,sCANpBQ,gBAAA,gBAHFC,QAAA,8BAcInB,QAAIC,+EAWOmB,0BAVbC,YAAA/B,mDAgBYC,OADZ+B,EAAA/B,EAAA+B,sDAKgB/B,EAAAgC,SAhEpBC,sBAAAC,MAAAC,EAAAb,UAAAc,OAAAC,KAAAC,MAAA,IAAAH,EAAAb,4CAmEIiB,mBAAJJ,EAAAK,qLAGaC,qBACAlC,QAAbmC,0BACY1C,QAAA2C,kCACO3C,EAAOmC,2BACnBJ,EAAAa,0BACgB5C,EAAOgC,qEAMkB,gBAAvBhC,mDAIRO,EAAQoC,0CAGDZ,EAAMc,GAd9BC,QAAA5B,IAAA6B,mGAuBOC,IAAIC,IAAQpB,KAAAqB,OAACC,IAAAA","file":"akamai/amp/mux/Mux.min.js","sourcesContent":["\nexport default class Mux {\n  constructor(player, config, mux) {\n    this.player = player\n    this.config = config\n    this.sdk = mux\n    this.data = Object.assign({\n      player_software_name: \"AMP\",\n      player_software_version: player.version,\n      player_mux_plugin_name: \"amp-mux\",\n      player_mux_plugin_version: \"1.66.0\",\n      player_init_time: player.initTime,\n    }, config.data)\n    \n    const element = player.container\n    \n    player.addEventListener(\"ready\", function (event) {\n      const ads = player.ads || {getEnabled: function () { return false; }, getInProgress: function () { return false; }}\n      \n      function mapEvents(target, map, isAdEvent) {\n        for (var muxEvent in map) {\n          target.addEventListener(map[muxEvent], function (element, muxEvent, playerEvent) {\n            if (!isAdEvent && ads.getInProgress())\n              return\n              \n            if (!/timeupdate/.test(muxEvent)) \n              console.log(\"mux.emit\", muxEvent); // TODO: Replace with player.logger.log\n              \n            mux.emit(element, muxEvent)\n          }.bind(null, element, muxEvent))\n        }\n      }\n      \n      mapEvents(player, {\n        \"play\": \"play\",\n        \"playing\": \"playing\",\n        \"pause\": \"pause\",\n        \"timeupdate\": \"timeupdate\",\n        \"seeking\": \"seeking\",\n        \"seeked\": \"seeked\",\n        \"error\": \"error\",\n        \"ended\": \"ended\",\n        \"stalled\": \"stalled\"\n      })\n      \n      player.addEventListener(\"mediachange\", function (event) {\n        var media = event.detail;\n        console.log(\"mux.emit\", \"videochange\");\n        mux.emit(element, \"videochange\", {\n          video_id: media.guid,\n          video_title: media.title,\n          video_duration: media.duration,\n          video_is_live: (media.temporalType == \"live\"),\n          video_poster_url: media.poster,\n          video_source_url: media.src,\n          video_source_mime_type: media.type\n        })\n      })\n      \n      if (ads.getEnabled()) {\n        mapEvents(ads, {\n          \"adrequest\": \"request\",\n          \"adresponse\": \"response\",\n          \"adbreakstart\": \"breakstart\",\n          \"adplay\": \"play\",\n          \"adplaying\": \"playing\",\n          \"adpause\": \"pause\",\n          \"adfirstquartile\": \"firstquartile\",\n          \"admidpoint\": \"midpoint\",\n          \"adthirdquartile\": \"thirdquartile\",\n          \"adended\": \"ended\",\n          \"adbreakend\": \"breakend\",\n          \"aderror\": \"error\"\n        }, true)\n        \n        mapEvents(ads, {\n          \"adplay\": \"breakstart\"\n        }, true)\n      }\n      \n      mux.emit(element, \"playerready\")\n    })\n    \n    mux.init(element, this)\n  }\n\n  getStateData() {\n    var player = this.player\n    var error = player.error || {}\n    var mediaElement = player.mediaElement\n    return {\n      video_language_code: player.language,\n      video_source_duration: isNaN(mediaElement.duration) ? undefined : Math.round(mediaElement.duration * 1000),\n      video_source_height: mediaElement.videoHeight,\n      video_source_width: mediaElement.videoWidth,\n      player_is_paused: player.paused,\n      player_playhead_time: this.getPlayheadTime(),\n      player_is_fullscreen: (player.displayState == \"fullscreen\"),\n      player_autoplay_on: player.autoplay,\n      player_preload_on: mediaElement.preload,\n      player_width: element.clientWidth,\n      player_height: element.clientHeight,\n      player_language_code: player.language,\n      player_error_code: error.code,\n      player_error_message: error.message\n    }\n  }\n  \n  getPlayheadTime() {\n    return Math.round(this.player.getCurrentTime() * 1000)\n  }\n  \n  static create(player, config) {\n    return new Promise((resolve, reject) => {\n      console.log(this)\n      resolve(new Mux(player, config, mux))\n    })\n  }\n}"]}