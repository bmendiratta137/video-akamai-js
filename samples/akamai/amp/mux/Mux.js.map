{"version":3,"file":"Mux.js","sources":["../../../../src/Mux.js","../../../../src/main.js"],"sourcesContent":["\nexport default class Mux {\n  constructor(player, config) {\n    this.player = player\n    this.config = config\n    this.sdk = mux\n    this.data = Object.assign({\n      player_software_name: \"AMP\",\n      player_software_version: player.version,\n      player_mux_plugin_name: \"amp-mux\",\n      player_mux_plugin_version: \"1.66.0\",\n      player_init_time: player.initTime,\n    }, config.data)\n\n    mux.init(player.container, this)\n  }\n\n  onready() {\n    const ads = player.ads || {enabled: false, inProgress: false}\n    const element = player.container\n\n    function mapEvents(target, map, isAdEvent) {\n      for (var muxEvent in map) {\n        target.addEventListener(map[muxEvent], function (element, muxEvent, playerEvent) {\n          if (!isAdEvent && ads.inProgress)\n            return\n\n          if (!/timeupdate/.test(muxEvent))\n            console.log(\"mux.emit\", muxEvent); // TODO: Replace with player.logger.log\n\n          mux.emit(element, muxEvent)\n        }.bind(null, element, muxEvent))\n      }\n    }\n\n    mapEvents(player, {\n      \"play\": \"play\",\n      \"playing\": \"playing\",\n      \"pause\": \"pause\",\n      \"timeupdate\": \"timeupdate\",\n      \"seeking\": \"seeking\",\n      \"seeked\": \"seeked\",\n      \"error\": \"error\",\n      \"ended\": \"ended\",\n      \"stalled\": \"stalled\"\n    })\n\n    if (ads.enabled === true) {\n      mapEvents(ads, {\n        \"adrequest\": \"request\",\n        \"adresponse\": \"response\",\n        \"adbreakstart\": \"breakstart\",\n        \"adplay\": \"play\",\n        \"adplaying\": \"playing\",\n        \"adpause\": \"pause\",\n        \"adfirstquartile\": \"firstquartile\",\n        \"admidpoint\": \"midpoint\",\n        \"adthirdquartile\": \"thirdquartile\",\n        \"adended\": \"ended\",\n        \"adbreakend\": \"breakend\",\n        \"aderror\": \"error\"\n      }, true)\n\n      mapEvents(ads, {\n        \"adplay\": \"breakstart\"\n      }, true)\n    }\n\n    mux.emit(element, \"playerready\")\n  }\n\n  onmediachange(event) {\n    const media = event.detail\n    console.log(\"mux.emit\", \"videochange\")\n    mux.emit(player.container, \"videochange\", {\n      video_id: media.guid,\n      video_title: media.title,\n      video_duration: media.duration,\n      video_is_live: (media.temporalType == \"live\"),\n      video_poster_url: media.poster,\n      video_source_url: media.src,\n      video_source_mime_type: media.type\n    })\n  }\n\n  getStateData() {\n    var player = this.player\n    var error = player.error || {}\n    var mediaElement = player.mediaElement\n    return {\n      video_language_code: player.language,\n      video_source_duration: isNaN(mediaElement.duration) ? undefined : Math.round(mediaElement.duration * 1000),\n      video_source_height: mediaElement.videoHeight,\n      video_source_width: mediaElement.videoWidth,\n      player_is_paused: player.paused,\n      player_playhead_time: this.getPlayheadTime(),\n      player_is_fullscreen: (player.displayState == \"fullscreen\"),\n      player_autoplay_on: player.autoplay,\n      player_preload_on: mediaElement.preload,\n      player_width: element.clientWidth,\n      player_height: element.clientHeight,\n      player_language_code: player.language,\n      player_error_code: error.code,\n      player_error_message: error.message\n    }\n  }\n\n  getPlayheadTime() {\n    return Math.round(this.player.getCurrentTime() * 1000)\n  }\n}\n","import Mux from \"./Mux.js\"\n\nakamai.amp.AMP.registerPlugin(\"mux\", akamai.amp.Plugin.createFactory(Mux))\n\nexport {Mux}\n"],"names":["Mux","player","config","sdk","mux","data","Object","assign","version","initTime","init","container","ads","enabled","inProgress","element","mapEvents","target","map","isAdEvent","muxEvent","addEventListener","playerEvent","test","console","log","emit","bind","event","media","detail","guid","title","duration","temporalType","poster","src","type","error","mediaElement","language","isNaN","undefined","Math","round","videoHeight","videoWidth","paused","getPlayheadTime","displayState","autoplay","preload","clientWidth","clientHeight","code","message","getCurrentTime","akamai","amp","AMP","registerPlugin","Plugin","createFactory"],"mappings":"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"}