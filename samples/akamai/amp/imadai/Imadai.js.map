{"version":3,"file":"Imadai.js","sources":["../../../../src/DAI.js","../../../../src/main.js"],"sourcesContent":["export default class DAI extends akamai.amp.AdPlugin {\n  constructor(player, config) {\n    super(player, config)\n\n    this.feature = \"ads\"\n    this.inProgress = false\n    this.streamManager = null\n    this.currentAd = null\n    this.adTimeRemaining = null\n    this.snapForwardTime = null\n\n    this.onAdEvent = this.onAdEvent.bind(this)\n\n    // setup transforms\n    if (config.transform !== false) {\n      this.transforms = {\n        [akamai.amp.TransformType.MEDIA]: {transform: this.mediaTransform.bind(this), priority: 1},\n        [akamai.amp.TransformType.TIME]: this.timeTransform.bind(this),\n        [akamai.amp.TransformType.SEEK]: this.seekTransform.bind(this)\n      }\n\n      for (let key in this.transforms) {\n        this.player.addTransform(key, this.transforms[key])\n      }\n    }\n  }\n\n  mediaTransform(media) {\n    return new Promise((resolve, reject) => {\n      // choose the correct request object\n      const isLive = (media.temporalType == \"live\")\n      const streamRequest = (isLive) ? new google.ima.dai.api.LiveStreamRequest() : new google.ima.dai.api.VODStreamRequest()\n\n      // the DAI params can come in from a number of sources\n      const metadata = (media.metadata) ? media.metadata.media || media.metadata : {}\n      const config = this.player.evaluateBindings(this.config, {media})\n      let source = akamai.amp.Utils.getSourceByType(media, \"application/x-mpegURL\")\n      if (source == null)\n        return reject(\"Could not find media\")\n      source = this.player.evaluateBindings(source, {media})\n\n      function getProperty(name, dflt) {\n        return source[name] || metadata[name] || config[name] || dflt\n      }\n\n      // init the stream request\n      streamRequest.adTagParameters = getProperty(\"adTagParameters\")\n      streamRequest.streamActivityMonitorId = getProperty(\"streamActivityMonitorId\")\n      streamRequest.apiKey = getProperty(\"apiKey\", \"\")\n\n      if (isLive) {\n        const assetKey = getProperty(\"assetKey\")\n\n        if (!assetKey)\n          return resolve(media)\n\n        streamRequest.assetKey = assetKey\n        streamRequest.attemptPreroll = getProperty(\"attemptPreroll\", true)\n\n        this.player.addEventListener(akamai.amp.Events.TIMED_METADATA, (event) => {\n          let cue = event.detail\n          if (this.streamManager && cue) {\n            this.streamManager.onTimedMetadata({\"TXXX\": cue.value.data})\n          }\n        })\n      }\n      else {\n        const videoId = getProperty(\"videoId\")\n        const contentSourceId = getProperty(\"contentSourceId\")\n\n        if (!contentSourceId)\n          return resolve(media)\n\n        streamRequest.contentSourceId = contentSourceId\n        streamRequest.videoId = videoId\n      }\n\n      // listen for stream request events\n      let onStreamEvent = (event) => {\n        this.logger.log(`[AMP IMA DAI] Stream Event: ${event.type}`, event)\n        this.streamManager.removeEventListener(\n          [google.ima.dai.api.StreamEvent.Type.LOADED,\n           google.ima.dai.api.StreamEvent.Type.ERROR],\n          onStreamEvent,\n          false)\n\n        switch (event.type) {\n          case google.ima.dai.api.StreamEvent.Type.LOADED:\n            // override the media's src property with the url provided by DAI\n            media.src = event.getStreamData().url\n            //this.player.timeline = new Timeline(this.streamManager, this.player.mediaElement)\n            this.logger.log(`[AMP IMA DAI] Media Source Fetched ${media.src}`)\n            break\n          case google.ima.dai.api.StreamEvent.Type.ERROR:\n            this.logger.log(\"[AMP IMA DAI] Media Source Fetch Error\", event)\n            break\n        }\n        resolve(media)\n      }\n\n      this.streamManager.addEventListener(\n        [google.ima.dai.api.StreamEvent.Type.LOADED,\n         google.ima.dai.api.StreamEvent.Type.ERROR],\n        onStreamEvent,\n        false)\n\n      // make the stream request\n      this.streamManager.requestStream(streamRequest)\n    })\n  }\n\n  timeTransform(time) {\n    return this.streamManager.contentTimeForStreamTime(time)\n  }\n\n  seekTransform(time) {\n    return this.streamManager.streamTimeForContentTime(time)\n  }\n\n  onready() {\n    this.logger.log(\"[AMP IMA DAI] SDK initialize\")\n\n    // create the stream manager\n    this.streamManager = new google.ima.dai.api.StreamManager(this.player.mediaElement)\n\n    if (this.player.ui && this.player.ui.ads && this.player.ui.container)\n      this.streamManager.setClickElement(this.player.ui.ads.container)\n\n    // listen for all available events\n    const events = []\n    for (let event in google.ima.dai.api.StreamEvent.Type) {\n      if (google.ima.dai.api.StreamEvent.Type.hasOwnProperty(event)) {\n        events.push(google.ima.dai.api.StreamEvent.Type[event])\n      }\n    }\n    this.streamManager.addEventListener(events, this.onAdEvent, false)\n  }\n\n  onmediachange() {\n    this.inProgress = false\n  }\n\n  onAdEvent(event) {\n    this.logger.log(`[AMP IMA DAI] Event: ${event.type}`, event)\n    switch (event.type) {\n      case google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED:\n        this.adBreakStart(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED:\n        this.adBreakEnd(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.STARTED:\n        this.adStarted(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.COMPLETE:\n        this.adEnded(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.AD_PROGRESS:\n        this.adProgress(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.CLICK:\n        this.adClick(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE:\n        this.adFirstQuartile(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.MIDPOINT:\n        this.adMidpoint(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE:\n        this.adThirdQuartile(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.CUEPOINTS_CHANGED:\n        this.cuePointsChanged(event)\n        break\n      case google.ima.dai.api.StreamEvent.Type.ERROR:\n        this.adError(event)\n        break\n    }\n  }\n\n  adBreakStart(event) {\n    this.inProgress = true\n    this.dispatch(akamai.amp.AdEvents.BREAK_START)\n  }\n\n  adStarted(event) {\n    if (this.inProgress == false)\n      this.adBreakStart()\n\n    const ad = event.getAd()\n    const companionAds = ad.getCompanionAds()\n    const adPodInfo = ad.getAdPodInfo()\n    const adPosition = adPodInfo.getAdPosition()\n    const adPodIndex = adPodInfo.getPodIndex()\n    const adType = (adPodIndex == 0) ? \"preroll\" : ((adPodIndex == -1) ? \"postroll\" : \"midroll\")\n\n    this.currentAd = new akamai.amp.AdVO(ad.getAdId(), ad.getTitle(), ad.getDuration(), adPosition, adType, \"ima-dai\", null, companionAds, null, ad, adPodInfo.getTotalAds())\n    this.companions = companionAds\n    this.dispatch(akamai.amp.AdEvents.LOADED, this.currentAd)\n    this.dispatch(akamai.amp.AdEvents.DURATION_CHANGE, this.currentAd)\n    this.dispatch(akamai.amp.AdEvents.STARTED, this.currentAd)\n  }\n\n  adFirstQuartile(event) {\n    this.dispatch(akamai.amp.AdEvents.FIRST_QUARTILE, this.currentAd)\n  }\n\n  adMidpoint(event) {\n    this.dispatch(akamai.amp.AdEvents.MIDPOINT, this.currentAd)\n  }\n\n  adThirdQuartile(event) {\n    this.dispatch(akamai.amp.AdEvents.THIRD_QUARTILE, this.currentAd)\n  }\n\n  adEnded(event) {\n    this.dispatch(akamai.amp.AdEvents.ENDED, this.currentAd)\n  }\n\n  adBreakEnd(event) {\n    this.inProgress = false\n    this.dispatch(akamai.amp.AdEvents.BREAK_END)\n    if (this.snapForwardTime && this.snapForwardTime > this.player.mediaElement.currentTime) {\n      this.player.mediaElement.currentTime = this.snapForwardTime\n      this.snapForwardTime = null\n    }\n  }\n\n  adProgress(event) {\n    const adProgressData = event.getStreamData().adProgressData\n    const currentTime = adProgressData.currentTime\n    const duration = adProgressData.duration\n\n    this.dispatch(akamai.amp.AdEvents.TIME_UPDATE, currentTime)\n    this.dispatch(akamai.amp.AdEvents.TIME_REMAINING, Math.floor(duration - currentTime))\n  }\n\n  adClick(event) {\n    if (!this.player.paused)\n      this.player.pause()\n\n    this.dispatch(akamai.amp.AdEvents.CLICKED, this.currentAd)\n  }\n\n  adError(event) {\n    this.dispatch(akamai.amp.AdEvents.ERROR, event.getStreamData().errorMessage)\n  }\n\n  cuePointsChanged(event) {\n    try {\n      const cues = []\n      event.getStreamData().cuepoints.forEach((cue) => {\n        cues.push({\"startTime\": this.streamManager.contentTimeForStreamTime(cue.start)})\n      })\n      if (cues.length)\n        this.player.cues = cues\n    } catch (error) {}\n  }\n\n  onseeked(event) {\n    const currentTime = this.player.mediaElement.currentTime\n    const previousCuePoint = this.streamManager.previousCuePointForStreamTime(currentTime)\n    if (previousCuePoint && !previousCuePoint.played) {\n      this.snapForwardTime = currentTime\n      this.player.mediaElement.currentTime = previousCuePoint.start\n    }\n  }\n}\n","import DAI from \"./DAI\"\n\nakamai.amp.AMP.registerPlugin(\"imadai\", akamai.amp.Plugin.createFactory(DAI))\n\nexport {DAI}\n"],"names":["DAI","player","config","feature","inProgress","streamManager","currentAd","adTimeRemaining","snapForwardTime","onAdEvent","bind","transform","transforms","akamai","amp","TransformType","MEDIA","mediaTransform","priority","TIME","timeTransform","SEEK","seekTransform","key","addTransform","media","Promise","resolve","reject","isLive","temporalType","streamRequest","google","ima","dai","api","LiveStreamRequest","VODStreamRequest","metadata","evaluateBindings","source","Utils","getSourceByType","getProperty","name","dflt","adTagParameters","streamActivityMonitorId","apiKey","assetKey","attemptPreroll","addEventListener","Events","TIMED_METADATA","event","cue","detail","onTimedMetadata","value","data","videoId","contentSourceId","onStreamEvent","logger","log","type","removeEventListener","StreamEvent","Type","LOADED","ERROR","src","getStreamData","url","requestStream","time","contentTimeForStreamTime","streamTimeForContentTime","StreamManager","mediaElement","ui","ads","container","setClickElement","events","hasOwnProperty","push","AD_BREAK_STARTED","adBreakStart","AD_BREAK_ENDED","adBreakEnd","STARTED","adStarted","COMPLETE","adEnded","AD_PROGRESS","adProgress","CLICK","adClick","FIRST_QUARTILE","adFirstQuartile","MIDPOINT","adMidpoint","THIRD_QUARTILE","adThirdQuartile","CUEPOINTS_CHANGED","cuePointsChanged","adError","dispatch","AdEvents","BREAK_START","ad","getAd","companionAds","getCompanionAds","adPodInfo","getAdPodInfo","adPosition","getAdPosition","adPodIndex","getPodIndex","adType","AdVO","getAdId","getTitle","getDuration","getTotalAds","companions","DURATION_CHANGE","ENDED","BREAK_END","currentTime","adProgressData","duration","TIME_UPDATE","TIME_REMAINING","Math","floor","paused","pause","CLICKED","errorMessage","cues","cuepoints","forEach","start","length","error","previousCuePoint","previousCuePointForStreamTime","played","AdPlugin","AMP","registerPlugin","Plugin","createFactory"],"mappings":"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"}