{"version":3,"file":"Chartbeatanalytics.js","sources":["../../../../src/ChartbeatAnalyticsStrategy.js","../../../../src/ChartbeatAnalytics.js","../../../../src/main.js"],"sourcesContent":["export default class ChartbeatAnalyticsStrategy {\n  static get ContentType() {\n    return {\n      AD: \"ad\",\n      CONTENT: \"ct\"\n    }\n  }\n\n  static get AdPosition() {\n    return {\n      PREROLL: \"a1\",\n      MIDROLL: \"a2\",\n      POSTROLL: \"a3\",\n      OVERLAY: \"a4\",\n      SPECIAL: \"a5\"\n    }\n  }\n\n  static get VideoState() {\n    return {\n      UNPLAYED: \"s1\",\n      PLAYED: \"s2\",\n      STOPPED: \"s3\",\n      COMPLETED: \"s4\"\n    }\n  }\n\n  static verify() {\n    return true\n  }\n\n  constructor(video) {\n    const player = video.amp\n    this.player = player\n\n    player.addEventListener(\"onmediachanged\", this.onmediachanged.bind(this))\n    player.addEventListener(\"onstarted\", this.onstarted.bind(this))\n    player.addEventListener(\"onplaying\", this.onplaying.bind(this))\n    player.addEventListener(\"onpaused\", this.onpaused.bind(this))\n    player.addEventListener(\"onended\", this.onended.bind(this))\n\n    let ads = player.ads\n    if (ads != null) {\n      ads.addEventListener(\"started\", this.onadstarted.bind(this))\n      ads.addEventListener(\"ended\", this.onadended.bind(this))\n    }\n  }\n\n  isReady() {\n    return this.isPlayerReady\n  }\n\n  getTitle() {\n    return this.player.media.title\n  }\n\n  getVideoPath() {\n    return this.player.src\n  }\n\n  getContentType() {\n    return this.contentType\n  }\n\n  getAdPosition() {\n    return this.adPosition\n  }\n\n  getTotalDuration() {\n    return this.player.duration * 1000\n  }\n\n  getState() {\n    return this.playbackState\n  }\n\n  getCurrentPlayTime() {\n    let currentTime = 0\n\n    if (this.player.media.isLive) {\n      currentTime = Math.floor(Date.now() / 1000)\n    }\n    else {\n      currentTime = this.player.currentTime.toFixed(1)\n    }\n\n    return currentTime\n  }\n\n  getBitrate() {\n    return this.player.quality || NaN\n  }\n\n  getThumbnailPath() {\n    return this.player.media.poster\n  }\n\n  getViewStartTime() {\n    return (this.videoStartTime) ? Math.round(Date.now() - this.videoStartTime) : 0\n  }\n\n  onmediachanged() {\n    this.playbackState = ChartbeatAnalyticsStrategy.VideoState.UNPLAYED\n    this.isPlayerReady = true\n  }\n\n  onstarted() {\n    this.contentType = ChartbeatAnalyticsStrategy.ContentType.CONTENT\n    this.videoStartTime = Date.now()\n  }\n\n  onplaying() {\n    this.contentType = ChartbeatAnalyticsStrategy.ContentType.CONTENT\n    this.playbackState = ChartbeatAnalyticsStrategy.VideoState.PLAYED\n  }\n\n  onended() {\n    this.playbackState = ChartbeatAnalyticsStrategy.VideoState.COMPLETED\n    this.videoStartTime = null\n  }\n\n  onpaused() {\n    this.playbackState = ChartbeatAnalyticsStrategy.VideoState.STOPPED\n  }\n\n  onadstarted(event) {\n    const adVO = event.detail\n    this.contentType = ChartbeatAnalyticsStrategy.ContentType.AD\n\n    if (adVO == null)\n      return\n\n    if (adVO.type == \"preroll\")\n      this.adPosition = ChartbeatAnalyticsStrategy.AdPosition.PREROLL\n    else if (adVO.type == \"midroll\")\n      this.adPosition = ChartbeatAnalyticsStrategy.AdPosition.MIDROLL\n    else if (adVO.type == \"postroll\")\n      this.adPosition = ChartbeatAnalyticsStrategy.AdPosition.POSTROLL\n  }\n\n  onadended(event) {\n    const adVO = event.detail\n    if (adVO == null || adVO.type != \"postroll\")\n      return\n\n    this.contentType = ChartbeatAnalyticsStrategy.ContentType.CONTENT\n  }\n}\n","import ChartbeatAnalyticsStrategy from \"./ChartbeatAnalyticsStrategy.js\"\n\nexport default class ChartbeatAnalytics extends akamai.amp.Plugin {\n\n  constructor(player, config) {\n    super(player, config)\n  }\n\n  setConfigMetadata() {\n    const config = window._sf_async_config = {}\n    const data = this.data.data\n\n    if (data == null)\n      return\n\n    for (let key in data) {\n      let value = data[key]\n      if (value == null || value == \"null\")\n        continue\n      config[key] = value\n    }\n  }\n\n  onready() {\n    window._cbv_strategies = window._cbv_strategies || []\n    window._cbv_strategies.push(ChartbeatAnalyticsStrategy)\n\n    _cbv = window._cbv || (window._cbv = [])\n    _cbv.push(this.player.mediaElement)\n\n    this.player.loadResources(this.config.sdk)\n  }\n\n  onmediachange() {\n    this.setConfigMetadata()\n  }\n}\n","import ChartbeatAnalytics from \"./ChartbeatAnalytics.js\"\n\nakamai.amp.AMP.registerPlugin(\"chartbeatanalytics\", akamai.amp.Plugin.createFactory(ChartbeatAnalytics))\n\nexport {ChartbeatAnalytics}\n"],"names":["ChartbeatAnalyticsStrategy","video","player","amp","addEventListener","onmediachanged","bind","onstarted","onplaying","onpaused","onended","ads","onadstarted","onadended","isPlayerReady","media","title","src","contentType","adPosition","duration","playbackState","currentTime","isLive","Math","floor","Date","now","toFixed","quality","NaN","poster","videoStartTime","round","VideoState","UNPLAYED","ContentType","CONTENT","PLAYED","COMPLETED","STOPPED","event","adVO","detail","AD","type","AdPosition","PREROLL","MIDROLL","POSTROLL","ChartbeatAnalytics","config","window","_sf_async_config","data","key","value","_cbv_strategies","push","_cbv","mediaElement","loadResources","sdk","setConfigMetadata","akamai","Plugin","AMP","registerPlugin","createFactory"],"mappings":"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"}