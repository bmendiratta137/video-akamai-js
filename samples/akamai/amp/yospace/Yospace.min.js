!function(e){"use strict";var a=function(e){function a(e,t){babelHelpers.classCallCheck(this,a);var n=babelHelpers.possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e,t));return n.feature="ads",n.inProgress=!1,n.bindHandlers(["AdBreakStart","AdBreakEnd","AdvertStart","AdvertEnd","UpdateTimeline","AnalyticsFired"]),YSSessionManager.DEFAULTS.DEBUGGING=n.debug,n.sdk={YSSessionManager:YSSessionManager,YSPlayerEvents:YSPlayerEvents},n.onclick=n.onclick.bind(n),t.transform!==!1&&n.player.addTransform(akamai.amp.TransformType.MEDIA,n.mediaTransform.bind(n)),n}return babelHelpers.inherits(a,e),babelHelpers.createClass(a,[{key:"onready",value:function(e){var a=this;this.player.hls&&this.player.hls.addEventListener("hlsFragParsingMetadata",function(e){var t=e.detail.data;if(t){for(var n=a.player.textTracks,r=null,i=0,s=n.length;i<s;i++)if("metadata"===n[i].kind){r=n[i];break}null!=r&&t.samples.forEach(function(e){var a=akamai.amp.Utils.arrayBufferToString(e.data).replace(/\n|\r|Ã¿/g,""),n=/(Y[A-Z]{3})([^Y]+)/g;n.test(a)&&a.replace(n,function(a,n,i){var s=new VTTCue(e.pts,t.frag.endPTS,"");s.type="org.id3",s.value={key:n,value:n+i,info:i},r.addCue(s)})})}})}},{key:"mediaTransform",value:function(e){var a=this;return this.createSession(e).then(function(t){return a.logger.log("[AMP YoSpace] Session Created",t),e.src=t,e})}},{key:"createSession",value:function(e){var a=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,r){var i="live"==e.temporalType?"createForLive":"createForVoD";a.sessionManager=YSSessionManager[i](e.src,t,function(e){return"error"==e?r("Could not create session"):(a.sessionManager.registerPlayer(a),void n(a.sessionManager.masterPlaylist()))})})}},{key:"reportEvent",value:function(e,a){null!=this.sessionManager&&this.sessionManager.reportPlayerEvent(e,a)}},{key:"AdBreakStart",value:function(){this.player.mediaElement.addEventListener("click",this.onclick),this.inProgress=!0,this.dispatch(akamai.amp.AdEvents.BREAK_START,new akamai.amp.AdVO)}},{key:"AdvertStart",value:function(e){this.dispatch(akamai.amp.AdEvents.STARTED,new akamai.amp.AdVO)}},{key:"AdvertEnd",value:function(e){this.dispatch(akamai.amp.AdEvents.ENDED,new akamai.amp.AdVO)}},{key:"AdBreakEnd",value:function(){this.player.mediaElement.removeEventListener("click",this.onclick),this.inProgress=!1,this.dispatch(akamai.amp.AdEvents.BREAK_END,new akamai.amp.AdVO)}},{key:"UpdateTimeline",value:function(e){console.log("YoSpace -> UpdateTimeline",e)}},{key:"AnalyticsFired",value:function(e,a){}},{key:"ontimeupdate",value:function(e){this.reportEvent(YSPlayerEvents.POSITION,e.detail)}},{key:"onfullscreenchange",value:function(e){this.reportEvent(YSPlayerEvents.FULLSCREEN,e.detail)}},{key:"onmuted",value:function(e){this.reportEvent(YSPlayerEvents.MUTE,e.detail)}},{key:"ontimedmetadata",value:function(e){var a=e.detail.value;if(/^Y/.test(a.key)){null==this.id3&&(this.id3={}),this.id3[a.key]=a.info;var t=Object.keys(this.id3),n=["YCSP","YDUR","YMID","YSEQ","YTYP"].filter(function(e){return!t.includes(e)});0===n.length&&(this.reportEvent(YSPlayerEvents.METADATA,this.id3),this.id3=null)}}},{key:"onmediasequencestarted",value:function(e){this.reportEvent(YSPlayerEvents.START)}},{key:"onmediasequenceended",value:function(e){this.reportEvent(YSPlayerEvents.END)}},{key:"onpause",value:function(e){this.reportEvent(YSPlayerEvents.PAUSE)}},{key:"onresume",value:function(e){this.reportEvent(YSPlayerEvents.RESUME)}},{key:"onseeking",value:function(e){this.reportEvent(YSPlayerEvents.SEEK_START,this.player.currentTime)}},{key:"onseeked",value:function(e){this.reportEvent(YSPlayerEvents.SEEK_END,this.player.currentTime)}},{key:"onclick",value:function(){this.reportEvent(YSPlayerEvents.CLICK)}},{key:"nonlinear",value:function(){var e=null;this.reportEvent(YSPlayerEvents.NONLINEAR,e)}}]),a}(akamai.amp.AdPlugin);akamai.amp.AMP.registerPlugin("yospace",akamai.amp.Plugin.createFactory(a)),e.YoSpace=a}(this.akamai.amp.yospace=this.akamai.amp.yospace||{});
//# sourceMappingURL=Yospace.min.js.map