{"version":3,"file":"Moat.js","sources":["../../../../src/Moat.js","../../../../src/MoatFlash.js","../../../../src/main.js"],"sourcesContent":["export default class Moat extends akamai.amp.Plugin {\n\n  constructor(player, config) {\n    super(player, config)\n  }\n\n  onready(event) {\n    let ads = this.player.ads\n    if (ads == null)\n      return\n\n    ads.addEventListener(\"breakstart\", this.onadbreakstart.bind(this))\n    ads.addEventListener(\"managerloaded\", this.onadmanagerloaded.bind(this))\n  }\n\n  track() {\n    const vo = this.adsManagerVO\n    const data = this.data\n\n    if (initMoatTracking == null || vo == null || data == null) {\n      return\n    }\n\n    initMoatTracking(vo.adManager, {\"partnerCode\": data.partnerCode, \"viewMode\": vo.viewMode, \"slicer1\": data.slicer1, \"slicer2\": data.slicer2}, vo.adContainer)\n  }\n\n  onmediachange(event) {\n    this.adsManagerVO = null\n  }\n\n  onadbreakstart(event) {\n    this.track()\n  }\n\n  onadmanagerloaded(event) {\n    this.adsManagerVO = event.detail\n    this.track()\n  }\n}\n","export default class MoatFlash extends akamai.amp.FlashPlugin {\n\n  constructor(player, config) {\n    super(player, config)\n  }\n\n  get flashPlugins() {\n    return [{\n      id: \"MOATAnalyticsPlugin\",\n      src: \"#{paths.resources}plugins/MOATAnalyticsPlugin.swf\",\n      blocking: false,\n      host: \"akamai\",\n      main: \"MOATAnalyticsPlugin\"\n    }]\n  }\n\n  createXML(event) {\n    const xml = event.detail.xml\n    const application = xml.firstChild\n    let metrics = xml.getElementsByTagName(\"metrics\")[0]\n\n    if (metrics == null) {\n      metrics = xml.createElement(\"metrics\")\n      application.appendChild(metrics)\n    }\n\n    const vendor = xml.createElement(\"vendor\")\n    vendor.setAttribute(\"id\", \"moat\")\n    metrics.appendChild(vendor)\n\n    const props = [\n      {value: this.config.data.partnerCode, key: \"partnerCode\"},\n      {value: this.config.data.slicer1, key: \"slicer1\"},\n      {value: this.config.data.slicer2, key: \"slicer2\"}\n    ]\n\n    props.forEach(function (prop) {\n      if (prop.value == null)\n        return\n      this.createProperty(xml, prop.key, prop.value, vendor)\n    })\n  }\n}\n","import Moat from \"./Moat.js\"\nimport MoatFlash from \"./MoatFlash.js\"\n\nakamai.amp.AMP.registerPlugin(\"moat\", \"html\", akamai.amp.Plugin.createFactory(Moat))\nakamai.amp.AMP.registerPlugin(\"moat\", \"flash\", akamai.amp.Plugin.createFactory(MoatFlash))\n\nexport {Moat}\nexport {MoatFlash}\n"],"names":["Moat","player","config","event","ads","addEventListener","onadbreakstart","bind","onadmanagerloaded","vo","adsManagerVO","data","initMoatTracking","adManager","partnerCode","viewMode","slicer1","slicer2","adContainer","track","detail","akamai","amp","Plugin","MoatFlash","xml","application","firstChild","metrics","getElementsByTagName","createElement","appendChild","vendor","setAttribute","props","value","key","forEach","prop","createProperty","FlashPlugin","AMP","registerPlugin","createFactory"],"mappings":";;;;;IAAqBA;;;gBAEPC,MAAZ,EAAoBC,MAApB,EAA4B;;mHACpBD,MADoB,EACZC,MADY;;;;;4BAIpBC,OAAO;UACTC,MAAM,KAAKH,MAAL,CAAYG,GAAtB;UACIA,OAAO,IAAX,EACE;;UAEEC,gBAAJ,CAAqB,YAArB,EAAmC,KAAKC,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,CAAnC;UACIF,gBAAJ,CAAqB,eAArB,EAAsC,KAAKG,iBAAL,CAAuBD,IAAvB,CAA4B,IAA5B,CAAtC;;;;4BAGM;UACAE,KAAK,KAAKC,YAAhB;UACMC,OAAO,KAAKA,IAAlB;;UAEIC,oBAAoB,IAApB,IAA4BH,MAAM,IAAlC,IAA0CE,QAAQ,IAAtD,EAA4D;;;;uBAI3CF,GAAGI,SAApB,EAA+B,EAAC,eAAeF,KAAKG,WAArB,EAAkC,YAAYL,GAAGM,QAAjD,EAA2D,WAAWJ,KAAKK,OAA3E,EAAoF,WAAWL,KAAKM,OAApG,EAA/B,EAA6IR,GAAGS,WAAhJ;;;;kCAGYf,OAAO;WACdO,YAAL,GAAoB,IAApB;;;;mCAGaP,OAAO;WACfgB,KAAL;;;;sCAGgBhB,OAAO;WAClBO,YAAL,GAAoBP,MAAMiB,MAA1B;WACKD,KAAL;;;;EApC8BE,OAAOC,GAAP,CAAWC;;ICAxBC;;;qBAEPvB,MAAZ,EAAoBC,MAApB,EAA4B;;6HACpBD,MADoB,EACZC,MADY;;;;;8BAclBC,OAAO;UACTsB,MAAMtB,MAAMiB,MAAN,CAAaK,GAAzB;UACMC,cAAcD,IAAIE,UAAxB;UACIC,UAAUH,IAAII,oBAAJ,CAAyB,SAAzB,EAAoC,CAApC,CAAd;;UAEID,WAAW,IAAf,EAAqB;kBACTH,IAAIK,aAAJ,CAAkB,SAAlB,CAAV;oBACYC,WAAZ,CAAwBH,OAAxB;;;UAGII,SAASP,IAAIK,aAAJ,CAAkB,QAAlB,CAAf;aACOG,YAAP,CAAoB,IAApB,EAA0B,MAA1B;cACQF,WAAR,CAAoBC,MAApB;;UAEME,QAAQ,CACZ,EAACC,OAAO,KAAKjC,MAAL,CAAYS,IAAZ,CAAiBG,WAAzB,EAAsCsB,KAAK,aAA3C,EADY,EAEZ,EAACD,OAAO,KAAKjC,MAAL,CAAYS,IAAZ,CAAiBK,OAAzB,EAAkCoB,KAAK,SAAvC,EAFY,EAGZ,EAACD,OAAO,KAAKjC,MAAL,CAAYS,IAAZ,CAAiBM,OAAzB,EAAkCmB,KAAK,SAAvC,EAHY,CAAd;;YAMMC,OAAN,CAAc,UAAUC,IAAV,EAAgB;YACxBA,KAAKH,KAAL,IAAc,IAAlB,EACE;aACGI,cAAL,CAAoBd,GAApB,EAAyBa,KAAKF,GAA9B,EAAmCE,KAAKH,KAAxC,EAA+CH,MAA/C;OAHF;;;;wBA9BiB;aACV,CAAC;YACF,qBADE;aAED,mDAFC;kBAGI,KAHJ;cAIA,QAJA;cAKA;OALD,CAAP;;;;EAPmCX,OAAOC,GAAP,CAAWkB;;ACGlDnB,OAAOC,GAAP,CAAWmB,GAAX,CAAeC,cAAf,CAA8B,MAA9B,EAAsC,MAAtC,EAA8CrB,OAAOC,GAAP,CAAWC,MAAX,CAAkBoB,aAAlB,CAAgC3C,IAAhC,CAA9C;AACAqB,OAAOC,GAAP,CAAWmB,GAAX,CAAeC,cAAf,CAA8B,MAA9B,EAAsC,OAAtC,EAA+CrB,OAAOC,GAAP,CAAWC,MAAX,CAAkBoB,aAAlB,CAAgCnB,SAAhC,CAA/C,EAEA,AACA;;;;;"}