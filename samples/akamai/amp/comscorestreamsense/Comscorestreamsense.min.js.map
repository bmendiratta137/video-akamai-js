{"version":3,"sources":["../../../../src/ComscoreStreamsense.js","../../../../src/main.js"],"names":["ads","this","stop","addEventListener","onadstarted","streamingTag","sdk","StreamingTag","customerC2","config","clientId","metadata","object","key","value","player","getMetaData","log","akamai","amp","Plugin","ComscoreStreamsense"],"mappings":"qaAaQA,cACF,OAAA,cAAA,gFAEiB,QAAQC,KAAAC,QACvBC,iBAAiB,UAAWF,KAAKG,QACjCD,iBAAiB,QAASF,KAAKC,uIAM/BG,aAAKA,GAALJ,MAAJK,IACEC,cAAAC,WAAAP,KAAAQ,OAAAC,+GAMQV,6DACNW,GAAAA,KAAWC,GAAf,IACIA,GAAUZ,EAAOa,EACrB,SAAKC,GAAmB,MAAAA,MAClBA,GAAQF,kRAgBVZ,aAAWe,qBAAfd,KAAAe,oBACIhB,OAAOiB,IAAP,khBApDyCC,IAAOC,IAAIC,eAAAA,sBAAAA,OAAAA,IAAAA,OAAAA,cAAAA,ICE5DF,EAAOC,oBAAuBE","file":"akamai/amp/comscorestreamsense/Comscorestreamsense.min.js","sourcesContent":["export default class ComscoreStreamsense extends akamai.amp.Plugin {\n  constructor(player, config) {\n    super(player, config)\n\n    this.sdk = akamai[\"amp\"].ns_\n    // Initialize the Comscore Streamsense SDK with CLient ID\n    // TODO: Why do we create the streaming tag here? It gets create when new media is loaded\n    if (this.sdk != null && this.streamingTag == null)\n      this.createStreamingTag()\n  }\n\n  onready() {\n    let ads = this.player.ads\n    if (ads == null)\n      return\n\n    this.bindHandlers([\"stop\", \"onadstarted\", \"onaderror\"])\n    ads.addEventListener(\"started\", this.onadstarted)\n    ads.addEventListener(\"ended\", this.stop)\n    ads.addEventListener(\"skipped\", this.stop)\n    ads.addEventListener(\"error\", this.onaderror)\n  }\n\n  createStreamingTag() {\n    if (this.streamingTag != null)\n      this.streamingTag.stop()\n    this.streamingTag = null\n    this.streamingTag = new this.sdk.StreamingTag({customerC2: this.config.clientId})\n  }\n\n  /* Get MetaData */\n  getMetaData(ads = false) {\n    let metadata = {}\n    let object = (ads) ? this.data.metadata.ads : this.data.metadata.video\n    for (let key in object) {\n      let value = object[key]\n      if (value == \"null\" || value == null)\n        continue\n      metadata[key] = value\n    }\n    return metadata\n  }\n\n  onmediachange() {\n    this.createStreamingTag()\n    this.logger.log(\"[AMP ComscoreStreamsense Event] Media Change, StreamTag ReInitialize\")\n  }\n\n  /* Media Started */\n  onplaying() {\n    /* Play Beacon */\n    let ads = this.player.ads\n    if (ads != null && (ads.getInProgress() || ads.inProgress))\n      return\n    this.streamingTag.playVideoContentPart(this.getMetaData())\n    this.logger.log(\"[AMP ComscoreStreamsense Event] Content Play\")\n  }\n\n  onpaused() {\n    this.stop()\n  }\n\n  /* Media Stop */\n  stop() {\n    this.streamingTag.stop()\n  }\n\n  /* Media Ended */\n  onended() {\n    /* MediaStop Ended */\n    // TODO: Why do we create the streaming tag here? It gets create when new media is loaded\n    //       Shouldn't this just be a call to stop?\n    this.createStreamingTag()\n    this.logger.log(\"[AMP ComscoreStreamsense Event] End\")\n  }\n\n  onadstarted() {\n    this.streamingTag.playVideoAdvertisement(this.getMetaData(true))\n    this.logger.log(\"[AMP ComscoreStreamsense Event] : Ad Start\")\n  }\n\n  onaderror() {\n    this.onadstarted()\n    this.stop()\n  }\n}\n","import ComscoreStreamsense from \"./ComscoreStreamsense.js\"\n\nakamai.amp.AMP.registerPlugin(\"comscorestreamsense\", akamai.amp.Plugin.createFactory(ComscoreStreamsense))\n\nexport {ComscoreStreamsense}\n"]}