{"version":3,"file":"Comscorestreamsense.js","sources":["../../../../src/ComscoreStreamsense.js","../../../../src/main.js"],"sourcesContent":["export default class ComscoreStreamsense extends akamai.amp.Plugin {\n  constructor(player, config) {\n    super(player, config)\n\n    this.sdk = akamai[\"amp\"].ns_\n    // Initialize the Comscore Streamsense SDK with CLient ID\n    // TODO: Why do we create the streaming tag here? It gets create when new media is loaded\n    if (this.sdk != null && this.streamingTag == null)\n      this.createStreamingTag()\n  }\n\n  onready() {\n    let ads = this.player.ads\n    if (ads == null)\n      return\n\n    this.bindHandlers([\"stop\", \"onadstarted\", \"onaderror\"])\n    ads.addEventListener(\"started\", this.onadstarted)\n    ads.addEventListener(\"ended\", this.stop)\n    ads.addEventListener(\"skipped\", this.stop)\n    ads.addEventListener(\"error\", this.onaderror)\n  }\n\n  createStreamingTag() {\n    if (this.streamingTag != null)\n      this.streamingTag.stop()\n    this.streamingTag = null\n    this.streamingTag = new this.sdk.StreamingTag({customerC2: this.config.clientId})\n  }\n\n  /* Get MetaData */\n  getMetaData(ads = false) {\n    let metadata = {}\n    let object = (ads) ? this.data.metadata.ads : this.data.metadata.video\n    for (let key in object) {\n      let value = object[key]\n      if (value == \"null\" || value == null)\n        continue\n      metadata[key] = value\n    }\n    return metadata\n  }\n\n  onmediachange() {\n    this.createStreamingTag()\n    this.logger.log(\"[AMP ComscoreStreamsense Event] Media Change, StreamTag ReInitialize\")\n  }\n\n  /* Media Started */\n  onplaying() {\n    /* Play Beacon */\n    let ads = this.player.ads\n    if (ads != null && (ads.getInProgress() || ads.inProgress))\n      return\n    this.streamingTag.playVideoContentPart(this.getMetaData())\n    this.logger.log(\"[AMP ComscoreStreamsense Event] Content Play\")\n  }\n\n  onpaused() {\n    this.stop()\n  }\n\n  /* Media Stop */\n  stop() {\n    this.streamingTag.stop()\n  }\n\n  /* Media Ended */\n  onended() {\n    /* MediaStop Ended */\n    // TODO: Why do we create the streaming tag here? It gets create when new media is loaded\n    //       Shouldn't this just be a call to stop?\n    this.createStreamingTag()\n    this.logger.log(\"[AMP ComscoreStreamsense Event] End\")\n  }\n\n  onadstarted() {\n    this.streamingTag.playVideoAdvertisement(this.getMetaData(true))\n    this.logger.log(\"[AMP ComscoreStreamsense Event] : Ad Start\")\n  }\n\n  onaderror() {\n    this.onadstarted()\n    this.stop()\n  }\n}\n","import ComscoreStreamsense from \"./ComscoreStreamsense.js\"\n\nakamai.amp.AMP.registerPlugin(\"comscorestreamsense\", akamai.amp.Plugin.createFactory(ComscoreStreamsense))\n\nexport {ComscoreStreamsense}\n"],"names":["ComscoreStreamsense","player","config","sdk","akamai","ns_","streamingTag","createStreamingTag","ads","bindHandlers","addEventListener","onadstarted","stop","onaderror","StreamingTag","customerC2","clientId","metadata","object","data","video","key","value","logger","log","getInProgress","inProgress","playVideoContentPart","getMetaData","playVideoAdvertisement","amp","Plugin","AMP","registerPlugin","createFactory"],"mappings":";;;;;IAAqBA;;;+BACPC,MAAZ,EAAoBC,MAApB,EAA4B;;;sJACpBD,MADoB,EACZC,MADY;;UAGrBC,GAAL,GAAWC,OAAO,KAAP,EAAcC,GAAzB;;;QAGI,MAAKF,GAAL,IAAY,IAAZ,IAAoB,MAAKG,YAAL,IAAqB,IAA7C,EACE,MAAKC,kBAAL;;;;;;8BAGM;UACJC,MAAM,KAAKP,MAAL,CAAYO,GAAtB;UACIA,OAAO,IAAX,EACE;;WAEGC,YAAL,CAAkB,CAAC,MAAD,EAAS,aAAT,EAAwB,WAAxB,CAAlB;UACIC,gBAAJ,CAAqB,SAArB,EAAgC,KAAKC,WAArC;UACID,gBAAJ,CAAqB,OAArB,EAA8B,KAAKE,IAAnC;UACIF,gBAAJ,CAAqB,SAArB,EAAgC,KAAKE,IAArC;UACIF,gBAAJ,CAAqB,OAArB,EAA8B,KAAKG,SAAnC;;;;yCAGmB;UACf,KAAKP,YAAL,IAAqB,IAAzB,EACE,KAAKA,YAAL,CAAkBM,IAAlB;WACGN,YAAL,GAAoB,IAApB;WACKA,YAAL,GAAoB,IAAI,KAAKH,GAAL,CAASW,YAAb,CAA0B,EAACC,YAAY,KAAKb,MAAL,CAAYc,QAAzB,EAA1B,CAApB;;;;;;;kCAIuB;UAAbR,GAAa,uEAAP,KAAO;;UACnBS,WAAW,EAAf;UACIC,SAAUV,GAAD,GAAQ,KAAKW,IAAL,CAAUF,QAAV,CAAmBT,GAA3B,GAAiC,KAAKW,IAAL,CAAUF,QAAV,CAAmBG,KAAjE;WACK,IAAIC,GAAT,IAAgBH,MAAhB,EAAwB;YAClBI,QAAQJ,OAAOG,GAAP,CAAZ;YACIC,SAAS,MAAT,IAAmBA,SAAS,IAAhC,EACE;iBACOD,GAAT,IAAgBC,KAAhB;;aAEKL,QAAP;;;;oCAGc;WACTV,kBAAL;WACKgB,MAAL,CAAYC,GAAZ,CAAgB,sEAAhB;;;;;;;gCAIU;;UAENhB,MAAM,KAAKP,MAAL,CAAYO,GAAtB;UACIA,OAAO,IAAP,KAAgBA,IAAIiB,aAAJ,MAAuBjB,IAAIkB,UAA3C,CAAJ,EACE;WACGpB,YAAL,CAAkBqB,oBAAlB,CAAuC,KAAKC,WAAL,EAAvC;WACKL,MAAL,CAAYC,GAAZ,CAAgB,8CAAhB;;;;+BAGS;WACJZ,IAAL;;;;;;;2BAIK;WACAN,YAAL,CAAkBM,IAAlB;;;;;;;8BAIQ;;;;WAIHL,kBAAL;WACKgB,MAAL,CAAYC,GAAZ,CAAgB,qCAAhB;;;;kCAGY;WACPlB,YAAL,CAAkBuB,sBAAlB,CAAyC,KAAKD,WAAL,CAAiB,IAAjB,CAAzC;WACKL,MAAL,CAAYC,GAAZ,CAAgB,4CAAhB;;;;gCAGU;WACLb,WAAL;WACKC,IAAL;;;;EAnF6CR,OAAO0B,GAAP,CAAWC;;ACE5D3B,OAAO0B,GAAP,CAAWE,GAAX,CAAeC,cAAf,CAA8B,qBAA9B,EAAqD7B,OAAO0B,GAAP,CAAWC,MAAX,CAAkBG,aAAlB,CAAgClC,mBAAhC,CAArD,EAEA;;;;"}