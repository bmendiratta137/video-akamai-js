!function(a){"use strict";var e=function(a){function e(a,i){babelHelpers.classCallCheck(this,e);var t=babelHelpers.possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,a,i));return t.akamaiLibrary=new JS_AkamaiMediaAnalytics(i.config),t.akamaiLibrary.disableLocation(),t.akamaiLibraryInitialised=!1,t}return babelHelpers.inherits(e,a),babelHelpers.createClass(e,[{key:"setDimensions",value:function(a){var e=this.config.dimensions;for(var i in a){var t=a[i];null!=t&&(e[i]=t)}return this.applyDimensions(e),a}},{key:"amaCallbacks",value:function(a){this.getStreamHeadPosition=function(){if(a)return a.getCurrentTime()}}},{key:"applyDimensions",value:function(a){try{for(var e in a)this.akamaiLibrary.setData(e,this.player.evaluateBindings(a[e]))}catch(a){this.player.logger.error("[AMP MEDIA ANALYTICS ERROR]","Could not set dimensions:",a)}}},{key:"onready",value:function(a){var e=this.player.ads;null!=e&&(e.addEventListener("breakstart",this.onadbreakstart.bind(this)),e.addEventListener("breakend",this.onadbreakend.bind(this)),e.addEventListener("loaded",this.onadloaded.bind(this)),e.addEventListener("started",this.onadstarted.bind(this)),e.addEventListener("ended",this.onadended.bind(this)),e.addEventListener("skipped",this.onadbreakskipped.bind(this)),e.addEventListener("error",this.onaderror.bind(this)),e.addEventListener("firstquartile",this.onadfirstquartile.bind(this)),e.addEventListener("midpoint",this.onadmidpoint.bind(this)),e.addEventListener("thirdquartile",this.onadthirdquartile.bind(this)))}},{key:"onplayrequest",value:function(a){0==this.akamaiLibraryInitialised&&(this.player.logger.log("[AMP MA EVENT] - handleSessionInit"),this.akamaiLibrary.handleSessionInit(new this.amaCallbacks(this.player)),this.akamaiLibraryInitialised=!0)}},{key:"onmediasequenceended",value:function(a){this.player.logger.log("[AMP MA EVENT] - handlePlayEnd"),this.akamaiLibrary.handlePlayEnd()}},{key:"onplaying",value:function(a){null!=this.player.ads&&this.player.ads.inProgress||(this.player.logger.log("[AMP MA EVENT] - handlePlaying"),this.akamaiLibrary.handlePlaying())}},{key:"onmediachange",value:function(a){var e=a.detail,i=null;this.akamaiLibraryInitialised=!1,this.player.logger.log("[AMP MA EVENT] - setStreamURL",e.src),this.akamaiLibrary.setStreamURL(e.src,!0);var t=this.config.viewerId||this.config.viewerID||this.config["std:viewerId"];null!=t&&this.akamaiLibrary.setViewerId(t);var n=e.mediaanalytics;i=null!=n&&null!=n.dimensions?akamia.amp.Utils.override(this.config.dimensions,n.dimensions):this.config.dimensions,this.applyDimensions(i)}},{key:"ondurationchange",value:function(a){this.player.logger.log("[AMP MA EVENT] - setStreamDuration",a.data),this.akamaiLibrary.setStreamDuration(a.data)}},{key:"updateMedia",value:function(a){this.player.logger.log("[AMP MA EVENT] - handleTitleSwitch"),this.akamaiLibrary.handleTitleSwitch(a)}},{key:"onfragmentloadstart",value:function(a){"function"==typeof fragmentDownloadStarted&&fragmentDownloadStarted(a.detail)}},{key:"onadbreakstart",value:function(){this.player.mediaElement.dataset.isad=!0}},{key:"onadbreakend",value:function(){this.player.mediaElement.dataset.isad=!1}},{key:"onadloaded",value:function(a){try{var e=a.data,i={adTitle:e.title,adDuration:e.duration,adPartnerId:e.partner,adId:e.id};this.player.logger.log("[AMP MA EVENT] - handleAdLoaded"),this.akamaiLibrary.handleAdLoaded(i)}catch(a){this.player.logger.error("[AMP MEDIA ANALYTICS ERROR]",a)}}},{key:"onadstarted",value:function(){this.player.logger.log("[AMP MA EVENT] - handleAdStarted"),this.akamaiLibrary.handleAdStarted()}},{key:"onadbreakskipped",value:function(){this.player.logger.log("[AMP MA EVENT] - handleAdSkipped"),this.akamaiLibrary.handleAdSkipped()}},{key:"onaderror",value:function(a){this.player.logger.log("[AMP MA EVENT] - handleAdError"),this.akamaiLibrary.handleAdError(a)}},{key:"onadfirstquartile",value:function(){this.player.logger.log("[AMP MA EVENT] - handleAdFirstQuartile"),this.akamaiLibrary.handleAdFirstQuartile()}},{key:"onadmidpoint",value:function(){this.player.logger.log("[AMP MA EVENT] - handleAdMidPoint"),this.akamaiLibrary.handleAdMidPoint()}},{key:"onadthirdquartile",value:function(){this.player.logger.log("[AMP MA EVENT] - handleAdThirdQuartile"),this.akamaiLibrary.handleAdThirdQuartile()}},{key:"onadended",value:function(){this.player.logger.log("[AMP MA EVENT] - handleAdComplete"),this.akamaiLibrary.handleAdComplete()}},{key:"onpause",value:function(){this.player.logger.log("[AMP MA EVENT] - handlePause"),this.akamaiLibrary.handlePause()}},{key:"onseeking",value:function(){(this.player.currentTime>.1||0===this.player.currentTime)&&(this.akamaiLibrary.handleSeekStart(),this.player.logger.log("[AMP MA EVENT] - handleSeekStart"))}},{key:"onseeked",value:function(){(this.player.currentTime>.1||0===this.player.currentTime)&&(this.akamaiLibrary.handleSeekEnd(),this.player.logger.log("[AMP MA EVENT] - handleSeekEnd"))}},{key:"onerror",value:function(a){this.player.logger.log("[AMP MA EVENT] - handleError",a.detail),this.akamaiLibrary.handleError(a.detail)}},{key:"onbufferingchange",value:function(a){this.player.logger.log("[AMP MA EVENT] - handleBufferStart",a.detail),a.detail===!0?this.akamaiLibrary.handleBufferStart():this.akamaiLibrary.handleBufferEnd()}},{key:"onqualitychanged",value:function(a){this.player.logger.log("[AMP MA EVENT] - handleBitRateSwitch",a.data.bitrate),this.akamaiLibrary.handleBitRateSwitch(a.data.bitrate)}}]),e}(akamai.amp.Plugin),i=function(a){function e(a,i){return babelHelpers.classCallCheck(this,e),babelHelpers.possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,a,i))}return babelHelpers.inherits(e,a),babelHelpers.createClass(e,[{key:"setDimensions",value:function(a){return this.player.mediaElement.setPlayerProperty("maDimensions",a),a}},{key:"createFlashVars",value:function(a){var e=a.detail.flashvars,i=this.player.config&&this.player.config.media&&this.player.config.media.mediaanalytics;if(null!=i)for(var t in i)e["report_"+t]=i[t]}},{key:"createXML",value:function(a){var e=a.detail.xml,i=e.firstChild,t=e.getElementsByTagName("metrics")[0];null==t&&(t=e.createElement("metrics"),i.appendChild(t));var n=e.createElement("vendor");if(n.setAttribute("id","akamai"),t.appendChild(n),null!=this.config.config){this.createProperty(e,"MEDIA_ANALYTICS_BEACON",this.config.config,n);var r=this.config.plugin.swf||"http://79423.analytics.edgesuite.net/csma/plugin/csma.swf";this.createProperty(e,"MEDIA_ANALYTICS_PLUGIN_PATH",r,n)}null!=this.config.dimensions&&this.createProperty(e,"dimensions",this.config.dimensions,n)}},{key:"onmediachange",value:function(a){var e=a.detail;if(e.mediaanalytics&&e.mediaanalytics.dimensions){e.dimensions=[];for(var i in e.mediaanalytics.dimensions)e.dimensions.push({key:i,value:e.mediaanalytics.dimensions[i]})}}},{key:"flashPlugins",get:function(){return[{id:"OSMFCSMALoader",host:"osmf",main:"com.akamai.playeranalytics.osmf.OSMFCSMALoaderInfo",type:"application/x-shockwave-flash"}]}}]),e}(akamai.amp.FlashPlugin);akamai.amp.AMP.registerPlugin("mediaanalytics","html",akamai.amp.Plugin.createFactory(e)),akamai.amp.AMP.registerPlugin("mediaanalytics","flash",akamai.amp.Plugin.createFactory(i)),a.MediaAnalytics=e}(this.akamai.amp.mediaanalytics=this.akamai.amp.mediaanalytics||{});
//# sourceMappingURL=Mediaanalytics.min.js.map