{"version":3,"file":"Mediaanalytics.js","sources":["../../../../src/MediaAnalytics.js","../../../../src/MediaAnalyticsFlash.js","../../../../src/main.js"],"sourcesContent":["export default class MediaAnalytics extends akamai.amp.Plugin {\n\n  constructor(player, config) {\n    super(player, config)\n    this.akamaiLibrary = new JS_AkamaiMediaAnalytics(config.config)\n    this.akamaiLibrary.disableLocation()\n    this.akamaiLibraryInitialised = false\n  }\n\n  setDimensions(value) {\n    let dimensions = this.config.dimensions\n    for (let key in value) {\n      let val = value[key]\n      if (val != null) {\n        dimensions[key] = val // TODO: Does this need to be evaluated for bindings?\n      }\n    }\n    this.applyDimensions(dimensions)\n    return value\n  }\n\n  amaCallbacks(playerInstance) {\n    this.getStreamHeadPosition = function() {\n      if (playerInstance) {\n        return playerInstance.getCurrentTime()\n      }\n    }\n  }\n\n  applyDimensions(dimensions) {\n    try {\n      for (let key in dimensions) {\n        this.akamaiLibrary.setData(key, this.player.evaluateBindings(dimensions[key]))\n      }\n    }\n    catch (error) {\n      this.player.logger.error(\"[AMP MEDIA ANALYTICS ERROR]\", \"Could not set dimensions:\", error)\n    }\n  }\n\n  onready(event) {\n    //this.akamaiLibrary.enableDebugLogging(this.debug)\n\n    let ads = this.player.ads\n    if (ads == null)\n      return\n\n    ads.addEventListener(\"breakstart\", this.onadbreakstart.bind(this))\n    ads.addEventListener(\"breakend\", this.onadbreakend.bind(this))\n    ads.addEventListener(\"loaded\", this.onadloaded.bind(this))\n    ads.addEventListener(\"started\", this.onadstarted.bind(this))\n    ads.addEventListener(\"ended\", this.onadended.bind(this))\n    ads.addEventListener(\"skipped\", this.onadbreakskipped.bind(this))\n    ads.addEventListener(\"error\", this.onaderror.bind(this))\n\n    ads.addEventListener(\"firstquartile\", this.onadfirstquartile.bind(this))\n    ads.addEventListener(\"midpoint\", this.onadmidpoint.bind(this))\n    ads.addEventListener(\"thirdquartile\", this.onadthirdquartile.bind(this))\n\n  }\n\n  onplayrequest(event) {\n    if (this.akamaiLibraryInitialised == false) {\n      this.player.logger.log(\"[AMP MA EVENT] - handleSessionInit\")\n      this.akamaiLibrary.handleSessionInit(new this.amaCallbacks(this.player))\n      this.akamaiLibraryInitialised = true\n    }\n  }\n\n  onmediasequenceended(event) {\n    this.player.logger.log(\"[AMP MA EVENT] - handlePlayEnd\")\n    this.akamaiLibrary.handlePlayEnd()\n  }\n\n  onplaying(event) {\n    if (this.player.ads != null && this.player.ads.inProgress)\n      return\n    this.player.logger.log(\"[AMP MA EVENT] - handlePlaying\")\n    this.akamaiLibrary.handlePlaying()\n  }\n\n  onmediachange(event) {\n    let media = event.detail\n    let dimensions = null\n\n    this.akamaiLibraryInitialised = false\n    this.player.logger.log(\"[AMP MA EVENT] - setStreamURL\", media.src)\n    this.akamaiLibrary.setStreamURL(media.src, true)\n\n    let viewerId = this.config.viewerId || this.config.viewerID || this.config[\"std:viewerId\"]\n    if (viewerId != null) {\n      this.akamaiLibrary.setViewerId(viewerId)\n    }\n\n    let config = media.mediaanalytics\n    if (config != null && config.dimensions != null) {\n      dimensions = akamia.amp.Utils.override(this.config.dimensions, config.dimensions)\n    } else {\n      dimensions = this.config.dimensions\n    }\n\n    //this.akamaiLibrary.handleStreamSwitch()\n    this.applyDimensions(dimensions)\n  }\n\n  ondurationchange(duaration) {\n    this.player.logger.log(\"[AMP MA EVENT] - setStreamDuration\", duaration.data)\n    this.akamaiLibrary.setStreamDuration(duaration.data)\n  }\n\n  updateMedia(media) {\n    this.player.logger.log(\"[AMP MA EVENT] - handleTitleSwitch\")\n    this.akamaiLibrary.handleTitleSwitch(media)\n  }\n\n  onfragmentloadstart(event) {\n    if (typeof fragmentDownloadStarted === \"function\") {\n      fragmentDownloadStarted(event.detail)\n    }\n  }\n\n  onadbreakstart() {\n    this.player.mediaElement.dataset.isad = true\n  }\n\n  onadbreakend() {\n    this.player.mediaElement.dataset.isad = false\n  }\n\n  onadloaded(event) {\n    try {\n      let adVO = event.data\n      let adObject = {\n        adTitle: adVO.title,\n        adDuration: adVO.duration,\n        adPartnerId: adVO.partner,\n        adId: adVO.id\n      }\n      this.player.logger.log(\"[AMP MA EVENT] - handleAdLoaded\")\n      this.akamaiLibrary.handleAdLoaded(adObject)\n    }\n    catch (error) {\n      this.player.logger.error(\"[AMP MEDIA ANALYTICS ERROR]\", error)\n    }\n  }\n\n  onadstarted() {\n    this.player.logger.log(\"[AMP MA EVENT] - handleAdStarted\")\n    this.akamaiLibrary.handleAdStarted()\n  }\n\n  onadbreakskipped() {\n    this.player.logger.log(\"[AMP MA EVENT] - handleAdSkipped\")\n    this.akamaiLibrary.handleAdSkipped()\n  }\n\n  onaderror(event) {\n    this.player.logger.log(\"[AMP MA EVENT] - handleAdError\")\n    this.akamaiLibrary.handleAdError(event)\n  }\n\n  onadfirstquartile() {\n    this.player.logger.log(\"[AMP MA EVENT] - handleAdFirstQuartile\")\n    this.akamaiLibrary.handleAdFirstQuartile()\n  }\n\n  onadmidpoint() {\n    this.player.logger.log(\"[AMP MA EVENT] - handleAdMidPoint\")\n    this.akamaiLibrary.handleAdMidPoint()\n  }\n\n  onadthirdquartile() {\n    this.player.logger.log(\"[AMP MA EVENT] - handleAdThirdQuartile\")\n    this.akamaiLibrary.handleAdThirdQuartile()\n  }\n\n  onadended() {\n    this.player.logger.log(\"[AMP MA EVENT] - handleAdComplete\")\n    this.akamaiLibrary.handleAdComplete()\n  }\n\n  onpause() {\n    this.player.logger.log(\"[AMP MA EVENT] - handlePause\")\n    this.akamaiLibrary.handlePause()\n  }\n\n  onseeking() {\n    if (this.player.currentTime > 0.1 || this.player.currentTime === 0) {\n      this.akamaiLibrary.handleSeekStart()\n      this.player.logger.log(\"[AMP MA EVENT] - handleSeekStart\")\n    }\n  }\n\n  onseeked() {\n    if (this.player.currentTime > 0.1 || this.player.currentTime === 0) {\n      this.akamaiLibrary.handleSeekEnd()\n      this.player.logger.log(\"[AMP MA EVENT] - handleSeekEnd\")\n    }\n  }\n\n  onerror(event) {\n    this.player.logger.log(\"[AMP MA EVENT] - handleError\", event.detail)\n    this.akamaiLibrary.handleError(event.detail)\n  }\n\n  onbufferingchange(event) {\n    this.player.logger.log(\"[AMP MA EVENT] - handleBufferStart\", event.detail)\n    if (event.detail === true)\n      this.akamaiLibrary.handleBufferStart()\n    else\n      this.akamaiLibrary.handleBufferEnd()\n  }\n\n  onqualitychanged(event) {\n    this.player.logger.log(\"[AMP MA EVENT] - handleBitRateSwitch\", event.data.bitrate)\n    this.akamaiLibrary.handleBitRateSwitch(event.data.bitrate)\n  }\n\n}\n","export default class MediaAnalyticsFlash extends akamai.amp.FlashPlugin {\n\n  constructor(player, config) {\n    super(player, config)\n  }\n\n  get flashPlugins() {\n    return [{\n      id: \"OSMFCSMALoader\",\n      host: \"osmf\",\n      main: \"com.akamai.playeranalytics.osmf.OSMFCSMALoaderInfo\",\n      type: \"application/x-shockwave-flash\"\n    }]\n  }\n\n  setDimensions(value) {\n    this.player.mediaElement.setPlayerProperty(\"maDimensions\", value)\n    return value\n  }\n\n  createFlashVars(event) {\n    const flashvars = event.detail.flashvars\n    const dimensions =  this.player.config && this.player.config.media && this.player.config.media.mediaanalytics\n\n    if (dimensions != null) {\n      for (let key in dimensions) {\n        flashvars[\"report_\" + key] = dimensions[key]\n      }\n    }\n  }\n\n  createXML(event) {\n    const xml = event.detail.xml\n    const application = xml.firstChild\n    let metrics = xml.getElementsByTagName(\"metrics\")[0]\n    let element = null\n\n    if (metrics == null) {\n      metrics = xml.createElement(\"metrics\")\n      application.appendChild(metrics)\n    }\n\n    const vendor = xml.createElement(\"vendor\")\n    vendor.setAttribute(\"id\", \"akamai\")\n    metrics.appendChild(vendor)\n\n    if (this.config.config != null) {\n      this.createProperty(xml, \"MEDIA_ANALYTICS_BEACON\", this.config.config, vendor)\n\n      const path = this.config.plugin.swf || \"http://79423.analytics.edgesuite.net/csma/plugin/csma.swf\"\n      this.createProperty(xml, \"MEDIA_ANALYTICS_PLUGIN_PATH\", path, vendor)\n    }\n\n    if (this.config.dimensions != null) {\n      this.createProperty(xml, \"dimensions\", this.config.dimensions, vendor)\n    }\n  }\n\n  onmediachange(event) {\n    const media = event.detail\n    if (media.mediaanalytics && media.mediaanalytics.dimensions) {\n      media.dimensions = []\n      for (let key in media.mediaanalytics.dimensions) {\n        media.dimensions.push({key: key, value: media.mediaanalytics.dimensions[key]})\n      }\n    }\n  }\n}\n","import MediaAnalytics from \"./MediaAnalytics.js\"\nimport MediaAnalyticsFlash from \"./MediaAnalyticsFlash.js\"\n\nakamai.amp.AMP.registerPlugin(\"mediaanalytics\", \"html\", akamai.amp.Plugin.createFactory(MediaAnalytics))\nakamai.amp.AMP.registerPlugin(\"mediaanalytics\", \"flash\", akamai.amp.Plugin.createFactory(MediaAnalyticsFlash))\n\nexport {MediaAnalytics}\n"],"names":["MediaAnalytics","player","config","akamaiLibrary","JS_AkamaiMediaAnalytics","disableLocation","akamaiLibraryInitialised","value","dimensions","key","val","applyDimensions","playerInstance","getStreamHeadPosition","getCurrentTime","setData","evaluateBindings","error","logger","event","ads","addEventListener","onadbreakstart","bind","onadbreakend","onadloaded","onadstarted","onadended","onadbreakskipped","onaderror","onadfirstquartile","onadmidpoint","onadthirdquartile","log","handleSessionInit","amaCallbacks","handlePlayEnd","inProgress","handlePlaying","media","detail","src","setStreamURL","viewerId","viewerID","setViewerId","mediaanalytics","akamia","amp","Utils","override","duaration","data","setStreamDuration","handleTitleSwitch","fragmentDownloadStarted","mediaElement","dataset","isad","adVO","adObject","title","duration","partner","id","handleAdLoaded","handleAdStarted","handleAdSkipped","handleAdError","handleAdFirstQuartile","handleAdMidPoint","handleAdThirdQuartile","handleAdComplete","handlePause","currentTime","handleSeekStart","handleSeekEnd","handleError","handleBufferStart","handleBufferEnd","bitrate","handleBitRateSwitch","akamai","Plugin","MediaAnalyticsFlash","setPlayerProperty","flashvars","xml","application","firstChild","metrics","getElementsByTagName","element","createElement","appendChild","vendor","setAttribute","createProperty","path","plugin","swf","push","FlashPlugin","AMP","registerPlugin","createFactory"],"mappings":"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"}