<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>AMP Premier</title>
		<!-- newrelic browser agent. REMEMBER TO REPLACE THIS SCRIPT WITH YOUR OWN BROWSER AGENT -->
		<script type="text/javascript" src="../agent.js"></script>

		<!--Player-->
		<link type="text/css" rel="stylesheet" href="../resources/styles/styles.css" />
		<script type="text/javascript" src="../resources/js/menu.js"></script>
		<script type="text/javascript" src="../amp.premier/amp.premier.min.js"></script>
		<script type="text/javascript">
			var amp, config, value, tracker
			menu = new FeedMenu(),
			feeds = [
        		"../resources/feeds/vod-feed.json",
        		"../resources/feeds/vod-feed-hinted.json",
        		"../resources/feeds/live-feed.json"
        	];

			function loadHandler(event) {
				menu.create(document.getElementById("sample-menu"), feeds, true);

				var xhr = new XMLHttpRequest();
				xhr.open("GET", "../amp.premier/amp.premier.json");
				xhr.onreadystatechange = function () {
					if (xhr.readyState != 4)
						return;
						
					config = JSON.parse(xhr.responseText);
										config.rules = {
						android_4_gets_m3u8: {
							regexp: "Android 4"
						}
					};
					
					if (config.flash != null)
						config.flash.static.enabled = (akamai.amp.utils.QueryString.static == "true");
					
					value = akamai.amp.utils.QueryString["amp-autoplay"];
					if (value != null)
						config.autoplay = (value == "true");
						
					value = akamai.amp.utils.QueryString["amp-cast-id"];
					if (value != null)
  					config.chromecast.applicationID = value;
					
					// Start NR tracker
					config.plugins = {
						newrelic: {
							resources: [{ src:'../../dist/newrelic-video-akamai.min.js', type: 'text/javascript' }]
						}
					}
					
					amp = akamai.amp.AMP.create("akamai-media-player", config, readyHandler);
				};
				xhr.send();
			}

			function readyHandler(event) {
				var index;

				amp.addEventListener("canplaythrough", logEvent);
				amp.addEventListener("ended", endedHandler);

				if (amp.ads != null) {
					amp.ads.addEventListener("started", adStartedHandler);
					amp.ads.addEventListener("ended", adEndedHandler);
					amp.ads.addEventListener("companion", companionHandler);
					amp.ads.addEventListener("request", adRequestHandler);
					amp.ads.addEventListener("firstquartile", adProgressHandler);
					amp.ads.addEventListener("midpoint", adProgressHandler);
					amp.ads.addEventListener("thirdquartile", adProgressHandler);
				}

				if (amp.autoadvance != null)
					amp.autoadvance.addEventListener("advance", advanceHandler);

				if (amp.recommendations != null)
					amp.recommendations.addEventListener("selected", selectedHandler);

				if (amp.share != null)
					amp.share.addEventListener("share", shareHandler);

				if (amp.auth != null)
					amp.auth.addEventListener("authenticated", authenticatedHandler);
			}

			function logEvent(event) {
				console.log(event.type, event);
			}

			function advanceHandler(event) {
				loadVideo(menu.selectedIndex + 1);
			}

			function loadVideo(index) {
				adEndedHandler();
				menu.select(index);
				location.hash = index;
				amp.feed.setData(menu.value);
			}

			function endedHandler(event) {
				console.log("ended");
			}

			function selectedHandler(event) {
				//do something
				console.log(event.detail);
			}

			function adRequestHandler(event) {
				console.log("Requesting Ad:", event);
			}

			function adProgressHandler(event) {
				console.log("Ad Progress: " + event.type, event);
			}

			function adStartedHandler(event) {
				document.getElementById("sample-video-area").className += " sample-ad-content";
				document.getElementById("sample-companion-ad").className += " sample-ad-content";
			}

			function adEndedHandler(event) {
				document.getElementById("sample-video-area").className = "sample-video-area";
				document.getElementById("sample-companion-ad").className = "sample-companion-ad";
			}

			function companionHandler(event) {
				var ads = event.detail.companions,
				    companions = document.getElementById("companion-ad"),
				    i = 0;

				companions.innerHTML = "";

				for (; i < ads.length; i++) {
					companions.innerHTML += ads[i].data;
				}
			}

			function shareHandler(event) {
				//do something
				console.log(event.detail);
				alert("Link: " + event.detail.link + "\n\n" + "Embed: " + event.detail.embed.url + "\n" + "\twidth: " + event.detail.embed.width + "\n" + "\theight: " + event.detail.embed.height + "\n");
			}

			function authenticatedHandler(event) {
				var div = document.getElementById("idps");
				var idps = amp.auth.getIdps();

				var innerHTML = '<div>Powered By: ' + idps.display_name + '</div>';
				if (idps.logos != null && idps.logos.full != null) {
					innerHTML += '<div><a href="' + idps.url + '"><img src="' + idps.logos.full + '" alt="' + idps.name + '" /></a></div>';
				}
				innerHTML += '<div class="logout" onclick="amp.auth.logout()">logout</div>';

				div.innerHTML = innerHTML;
			}
		</script>
		<style>
			.sample-video-area {
				background: #888888;
			}
		</style>
	</head>
	<!-- HACK: ontouchstart="" is a workaround that enables the use of the CSS :active psuedo class on iOS -->
	<body onload="loadHandler(event)" ontouchstart="">
		<div class="page">
			<div class="header">
				<div class="header-logo"></div>
				<div class="header-text">
					<h1>AMP Premier</h1>
					<h2>v2.68.16</h2>
				</div>
			</div>

			<div class="content">
				<div id="sample-video-area" class="sample-video-area">
					<div class="sample-ad-video-text sample-label-text">
						Advertisement
					</div>
					<div class="sample-player">
						<div id="akamai-media-player"></div>
					</div>
				</div>
				<div id="sample-menu" class="sample-menu"></div>
				<div class="sample-footer">
					<div id="sample-companion-ad" class="sample-companion-ad">
						<div class="sample-label-text">
							Sponsored by
						</div>
						<div id="companion-ad" class="companion-ad"></div>
					</div>
					<div id="idps" class="idps"></div>
				</div>
			</div>
		</div>
	</body>
</html>
